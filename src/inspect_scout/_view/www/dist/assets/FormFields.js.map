{"version":3,"file":"FormFields.js","sources":["../../src/app/project/components/FormFields.tsx"],"sourcesContent":["import {\n  VscodeFormHelper,\n  VscodeLabel,\n  VscodeOption,\n  VscodeSingleSelect,\n  VscodeTextarea,\n  VscodeTextfield,\n} from \"@vscode-elements/react-elements\";\nimport { FC, ReactNode, useEffect, useState } from \"react\";\n\nimport styles from \"../ProjectPanel.module.css\";\n\n// Helper to extract input value with proper typing\nfunction getInputValue(e: Event): string {\n  return (e.target as HTMLInputElement).value;\n}\n\nfunction getSelectValue(e: Event): string {\n  return (e.target as HTMLSelectElement).value;\n}\n\n// Helper to disable spellcheck on web component shadow DOM elements\nfunction createSpellcheckRef(selector: \"input\" | \"textarea\") {\n  return (el: HTMLElement | null) => {\n    if (!el) return;\n    el.setAttribute(\"spellcheck\", \"false\");\n    const shadowEl = el.shadowRoot?.querySelector(selector);\n    if (shadowEl) {\n      shadowEl.setAttribute(\"spellcheck\", \"false\");\n    }\n  };\n}\n\n// ===== TextField Component =====\ninterface TextFieldProps {\n  id?: string;\n  label: string;\n  helper?: ReactNode;\n  value: string | null | undefined;\n  onChange: (value: string | null) => void;\n  placeholder?: string;\n  disabled?: boolean;\n  /** Optional validation function. Returns error message if invalid, null if valid. */\n  validate?: (value: string | null) => string | null;\n}\n\nexport const TextField: FC<TextFieldProps> = ({\n  id,\n  label,\n  helper,\n  value,\n  onChange,\n  placeholder,\n  disabled,\n  validate,\n}) => {\n  // Debounce validation errors to avoid flashing during typing\n  const [debouncedError, setDebouncedError] = useState<string | null>(null);\n  const errorMessage = validate && !disabled ? validate(value ?? null) : null;\n\n  useEffect(() => {\n    if (errorMessage) {\n      const timer = setTimeout(() => setDebouncedError(errorMessage), 1000);\n      return () => clearTimeout(timer);\n    } else {\n      // Clear error immediately when input becomes valid\n      // TODO: lint react-hooks/set-state-in-effect - consider if fixing this violation makes sense\n      // eslint-disable-next-line react-hooks/set-state-in-effect\n      setDebouncedError(null);\n    }\n  }, [errorMessage]);\n\n  return (\n    <div className={styles.field}>\n      <VscodeLabel>{label}</VscodeLabel>\n      {helper && <VscodeFormHelper>{helper}</VscodeFormHelper>}\n      <VscodeTextfield\n        id={id}\n        ref={createSpellcheckRef(\"input\")}\n        value={value ?? \"\"}\n        disabled={disabled}\n        onInput={(e) => onChange(getInputValue(e) || null)}\n        placeholder={placeholder}\n        spellCheck={false}\n        autocomplete=\"off\"\n      />\n      {debouncedError && (\n        <VscodeFormHelper\n          style={{ color: \"var(--vscode-errorForeground)\", marginTop: \"4px\" }}\n        >\n          {debouncedError}\n        </VscodeFormHelper>\n      )}\n    </div>\n  );\n};\n\n// ===== TextAreaField Component =====\ninterface TextAreaFieldProps {\n  id?: string;\n  label: string;\n  helper?: ReactNode;\n  value: string | null | undefined;\n  onChange: (value: string | null) => void;\n  placeholder?: string;\n  disabled?: boolean;\n  rows?: number;\n}\n\nexport const TextAreaField: FC<TextAreaFieldProps> = ({\n  id,\n  label,\n  helper,\n  value,\n  onChange,\n  placeholder,\n  disabled,\n  rows = 3,\n}) => {\n  return (\n    <div className={styles.field}>\n      <VscodeLabel>{label}</VscodeLabel>\n      {helper && <VscodeFormHelper>{helper}</VscodeFormHelper>}\n      <VscodeTextarea\n        id={id}\n        ref={createSpellcheckRef(\"textarea\")}\n        value={value ?? \"\"}\n        disabled={disabled}\n        onInput={(e) => onChange(getInputValue(e) || null)}\n        placeholder={placeholder}\n        rows={rows}\n        spellCheck={false}\n        autocomplete=\"off\"\n      />\n    </div>\n  );\n};\n\n// ===== KeyValueField Component =====\n// Handles key=value pairs (one per line) or plain string values\n\n/**\n * Convert an object or string to key=value lines for display.\n */\nexport function objectToKeyValueLines(\n  value: Record<string, unknown> | string | null | undefined\n): string {\n  if (!value) return \"\";\n  if (typeof value === \"string\") return value;\n  return Object.entries(value)\n    .map(([k, v]) => `${k}=${String(v)}`)\n    .join(\"\\n\");\n}\n\n/**\n * Parse key=value lines into an object, or return as string if it looks like a path.\n * Numeric values are preserved as numbers.\n */\nexport function parseKeyValueLines(\n  text: string | null\n): Record<string, string | number> | string | null {\n  if (!text?.trim()) return null;\n\n  // If it looks like a file path, return as string\n  const trimmed = text.trim();\n  if (\n    trimmed.startsWith(\"/\") ||\n    trimmed.startsWith(\"./\") ||\n    trimmed.startsWith(\"~\") ||\n    /^[a-zA-Z]:\\\\/.test(trimmed) // Windows path\n  ) {\n    return trimmed;\n  }\n\n  // Parse as key=value pairs\n  const result: Record<string, string | number> = {};\n  for (const line of text.split(\"\\n\")) {\n    const lineTrimmed = line.trim();\n    if (!lineTrimmed) continue;\n    const eqIndex = lineTrimmed.indexOf(\"=\");\n    if (eqIndex > 0) {\n      const key = lineTrimmed.slice(0, eqIndex).trim();\n      const val = lineTrimmed.slice(eqIndex + 1).trim();\n      if (key) {\n        // Try to parse as number if it looks numeric\n        const num = Number(val);\n        if (val !== \"\" && !isNaN(num)) {\n          result[key] = num;\n        } else {\n          result[key] = val;\n        }\n      }\n    }\n  }\n\n  return Object.keys(result).length > 0 ? result : null;\n}\n\ninterface KeyValueFieldProps {\n  id?: string;\n  label: string;\n  helper?: ReactNode;\n  value: Record<string, unknown> | string | null | undefined;\n  onChange: (value: Record<string, string | number> | string | null) => void;\n  placeholder?: string;\n  disabled?: boolean;\n  rows?: number;\n}\n\nexport const KeyValueField: FC<KeyValueFieldProps> = ({\n  id,\n  label,\n  helper,\n  value,\n  onChange,\n  placeholder = \"key=value\",\n  disabled,\n  rows = 3,\n}) => {\n  // Use local state to allow free typing without losing input\n  const [text, setText] = useState(() => objectToKeyValueLines(value));\n\n  // Sync local state when value changes externally (e.g., after save)\n  useEffect(() => {\n    const configText = objectToKeyValueLines(value);\n    // Only sync if parsed values differ (avoids cursor jump while typing)\n    const currentParsed = parseKeyValueLines(text);\n    const valueParsed = parseKeyValueLines(configText);\n    if (JSON.stringify(currentParsed) !== JSON.stringify(valueParsed)) {\n      setText(configText);\n    }\n    // TODO: lint react-hooks/exhaustive-deps - review this\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [value]);\n\n  const handleInput = (newText: string) => {\n    setText(newText);\n    // Also update config immediately so Ctrl+S works\n    onChange(parseKeyValueLines(newText));\n  };\n\n  return (\n    <div className={styles.field}>\n      <VscodeLabel>{label}</VscodeLabel>\n      {helper && <VscodeFormHelper>{helper}</VscodeFormHelper>}\n      <VscodeTextarea\n        id={id}\n        ref={createSpellcheckRef(\"textarea\")}\n        value={text}\n        disabled={disabled}\n        onInput={(e) => handleInput(getInputValue(e))}\n        placeholder={placeholder}\n        rows={rows}\n        spellCheck={false}\n        autocomplete=\"off\"\n      />\n    </div>\n  );\n};\n\n// ===== NumberField Component =====\ninterface NumberFieldProps {\n  id?: string;\n  label: string;\n  helper?: ReactNode;\n  value: number | null | undefined;\n  onChange: (value: number | null) => void;\n  placeholder?: string;\n  disabled?: boolean;\n  step?: number;\n}\n\nexport const NumberField: FC<NumberFieldProps> = ({\n  id,\n  label,\n  helper,\n  value,\n  onChange,\n  placeholder,\n  disabled,\n  step,\n}) => {\n  const handleInput = (e: Event) => {\n    const val = getInputValue(e);\n    const num = step ? parseFloat(val) : parseInt(val, 10);\n    onChange(isNaN(num) ? null : num);\n  };\n\n  return (\n    <div className={styles.field}>\n      <VscodeLabel>{label}</VscodeLabel>\n      {helper && <VscodeFormHelper>{helper}</VscodeFormHelper>}\n      <VscodeTextfield\n        id={id}\n        type=\"number\"\n        step={step}\n        value={value?.toString() ?? \"\"}\n        disabled={disabled}\n        onInput={handleInput}\n        placeholder={placeholder}\n        spellCheck={false}\n        autocomplete=\"off\"\n      />\n    </div>\n  );\n};\n\n// ===== SelectField Component =====\ninterface SelectFieldProps<T extends string> {\n  id?: string;\n  label: string;\n  helper?: ReactNode;\n  value: T | null | undefined;\n  options: readonly T[];\n  onChange: (value: T | null) => void;\n  disabled?: boolean;\n  defaultLabel?: string;\n}\n\nexport function SelectField<T extends string>({\n  id,\n  label,\n  helper,\n  value,\n  options,\n  onChange,\n  disabled,\n  defaultLabel = \"Default\",\n}: SelectFieldProps<T>): ReactNode {\n  return (\n    <div className={styles.field}>\n      <VscodeLabel>{label}</VscodeLabel>\n      {helper && <VscodeFormHelper>{helper}</VscodeFormHelper>}\n      <VscodeSingleSelect\n        id={id}\n        value={value ?? \"\"}\n        disabled={disabled}\n        onChange={(e) => {\n          const val = getSelectValue(e);\n          onChange(val ? (val as T) : null);\n        }}\n      >\n        <VscodeOption value=\"\">{defaultLabel}</VscodeOption>\n        {options.map((opt) => (\n          <VscodeOption key={opt} value={opt}>\n            {opt}\n          </VscodeOption>\n        ))}\n      </VscodeSingleSelect>\n    </div>\n  );\n}\n\n// ===== Field Component =====\ninterface FieldProps {\n  label: string;\n  helper?: ReactNode;\n  children: ReactNode;\n}\n\nexport function Field({ label, helper, children }: FieldProps): ReactNode {\n  return (\n    <div className={styles.field}>\n      <VscodeLabel>{label}</VscodeLabel>\n      {helper && <VscodeFormHelper>{helper}</VscodeFormHelper>}\n      {children}\n    </div>\n  );\n}\n"],"names":["useState","useEffect","jsxs","jsx"],"mappings":"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"}