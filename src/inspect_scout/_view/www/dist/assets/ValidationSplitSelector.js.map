{"version":3,"file":"ValidationSplitSelector.js","sources":["../../src/app/server/useValidations.ts","../../src/app/validation/utils.ts","../../src/hooks/useDropdownPosition.ts","../../src/app/validation/components/ValidationSetSelector.tsx","../../src/app/validation/components/ValidationSplitSelector.tsx"],"sourcesContent":["import { skipToken, useMutation, useQueryClient } from \"@tanstack/react-query\";\n\nimport { ApiError } from \"../../api/request\";\nimport { useApi } from \"../../state/store\";\nimport {\n  CreateValidationSetRequest,\n  ValidationCase,\n  ValidationCaseRequest,\n} from \"../../types/api-types\";\nimport { AsyncData } from \"../../utils/asyncData\";\nimport { useAsyncDataFromQuery } from \"../../utils/asyncDataFromQuery\";\n\n/**\n * Query key factory for validation-related queries.\n * Centralizes key definitions to ensure consistency between queries and invalidations.\n */\nexport const validationQueryKeys = {\n  sets: () => [\"validationSets\"] as const,\n  cases: (uri: string | typeof skipToken) => [\"validationCases\", uri] as const,\n  case: (params: { url: string; caseId: string } | typeof skipToken) =>\n    [\"validationCase\", params] as const,\n};\n\n/**\n * Hook to fetch all validation set URIs in the project.\n */\nexport const useValidationSets = (): AsyncData<string[]> => {\n  const api = useApi();\n  return useAsyncDataFromQuery({\n    queryKey: validationQueryKeys.sets(),\n    queryFn: () => api.getValidationSets(),\n    staleTime: 60 * 1000,\n  });\n};\n\n/**\n * Hook to fetch validation cases for a specific validation set.\n */\nexport const useValidationCases = (\n  uri: string | typeof skipToken\n): AsyncData<ValidationCase[]> => {\n  const api = useApi();\n  return useAsyncDataFromQuery({\n    queryKey: validationQueryKeys.cases(uri),\n    queryFn: uri === skipToken ? skipToken : () => api.getValidationCases(uri),\n    staleTime: 60 * 1000,\n    enabled: uri !== skipToken,\n  });\n};\n\n/**\n * Hook to fetch a single validation case by URI and case ID.\n * Returns null (not an error) when the case is not found (404).\n */\nexport const useValidationCase = (\n  params: { url: string; caseId: string } | typeof skipToken\n): AsyncData<ValidationCase | null> => {\n  const api = useApi();\n\n  return useAsyncDataFromQuery({\n    queryKey: validationQueryKeys.case(params),\n    queryFn:\n      params === skipToken\n        ? skipToken\n        : async () => {\n            try {\n              return await api.getValidationCase(params.url, params.caseId);\n            } catch (error) {\n              if (error instanceof ApiError && error.status === 404) {\n                return null;\n              }\n              throw error;\n            }\n          },\n    staleTime: 60 * 1000,\n  });\n};\n\n/**\n * Hook to create a new validation set.\n */\nexport const useCreateValidationSet = () => {\n  const queryClient = useQueryClient();\n  const api = useApi();\n  return useMutation<string, Error, CreateValidationSetRequest>({\n    mutationFn: (request) => api.createValidationSet(request),\n    onSuccess: () => {\n      void queryClient.invalidateQueries({\n        queryKey: validationQueryKeys.sets(),\n      });\n    },\n  });\n};\n\n/**\n * Hook to update a validation case (upsert).\n * Uses optimistic updates to prevent UI flicker during save.\n */\nexport const useUpdateValidationCase = (uri: string) => {\n  const queryClient = useQueryClient();\n  const api = useApi();\n  return useMutation<\n    ValidationCase,\n    Error,\n    { caseId: string; data: ValidationCaseRequest },\n    {\n      previousCase: ValidationCase | undefined;\n      previousCases: ValidationCase[] | undefined;\n    }\n  >({\n    mutationFn: ({ caseId, data }) =>\n      api.upsertValidationCase(uri, caseId, data),\n\n    onMutate: ({ caseId, data }) => {\n      // Cancel any outgoing refetches to avoid overwriting optimistic update\n      void queryClient.cancelQueries({\n        queryKey: validationQueryKeys.case({ url: uri, caseId }),\n      });\n      void queryClient.cancelQueries({\n        queryKey: validationQueryKeys.cases(uri),\n      });\n\n      // Snapshot the previous values for rollback\n      const previousCase = queryClient.getQueryData<ValidationCase>(\n        validationQueryKeys.case({ url: uri, caseId })\n      );\n      const previousCases = queryClient.getQueryData<ValidationCase[]>(\n        validationQueryKeys.cases(uri)\n      );\n\n      // Optimistically update both caches\n      if (previousCase) {\n        queryClient.setQueryData(\n          validationQueryKeys.case({ url: uri, caseId }),\n          { ...previousCase, ...data }\n        );\n      }\n      if (previousCases) {\n        queryClient.setQueryData(\n          validationQueryKeys.cases(uri),\n          previousCases.map((c) => (c.id === caseId ? { ...c, ...data } : c))\n        );\n      }\n\n      return { previousCase, previousCases };\n    },\n\n    onError: (_err, { caseId }, context) => {\n      // Rollback to previous values on error\n      if (context?.previousCase) {\n        queryClient.setQueryData(\n          validationQueryKeys.case({ url: uri, caseId }),\n          context.previousCase\n        );\n      }\n      if (context?.previousCases) {\n        queryClient.setQueryData(\n          validationQueryKeys.cases(uri),\n          context.previousCases\n        );\n      }\n    },\n\n    onSuccess: (_data, { caseId }) => {\n      // Invalidate both queries to sync with server.\n      // Since we've already optimistically updated both caches, the invalidation\n      // will refetch in the background without causing UI flicker.\n      void queryClient.invalidateQueries({\n        queryKey: validationQueryKeys.case({ url: uri, caseId }),\n      });\n      void queryClient.invalidateQueries({\n        queryKey: validationQueryKeys.cases(uri),\n      });\n    },\n  });\n};\n\n/**\n * Hook to delete a single validation case.\n */\nexport const useDeleteValidationCase = (uri: string) => {\n  const queryClient = useQueryClient();\n  const api = useApi();\n  return useMutation<void, Error, string>({\n    mutationFn: (caseId) => api.deleteValidationCase(uri, caseId),\n    onSuccess: () => {\n      void queryClient.invalidateQueries({\n        queryKey: validationQueryKeys.cases(uri),\n      });\n    },\n  });\n};\n\n/**\n * Hook to delete multiple validation cases (bulk delete).\n * Uses Promise.allSettled to handle partial failures gracefully.\n */\nexport const useBulkDeleteValidationCases = (uri: string) => {\n  const queryClient = useQueryClient();\n  const api = useApi();\n  return useMutation<{ succeeded: number; failed: number }, Error, string[]>({\n    mutationFn: async (caseIds) => {\n      const results = await Promise.allSettled(\n        caseIds.map((id) => api.deleteValidationCase(uri, id))\n      );\n\n      const succeeded = results.filter((r) => r.status === \"fulfilled\").length;\n      const failed = results.filter((r) => r.status === \"rejected\").length;\n\n      // Always invalidate cache if at least one succeeded\n      if (succeeded > 0) {\n        void queryClient.invalidateQueries({\n          queryKey: validationQueryKeys.cases(uri),\n        });\n      }\n\n      // Throw if all failed\n      if (failed === results.length) {\n        const errors = results\n          .filter((r): r is PromiseRejectedResult => r.status === \"rejected\")\n          .map((r) => r.reason);\n        throw new Error(`All deletions failed: ${errors.join(\", \")}`);\n      }\n\n      return { succeeded, failed };\n    },\n  });\n};\n\n/**\n * Hook to delete an entire validation set.\n */\nexport const useDeleteValidationSet = () => {\n  const queryClient = useQueryClient();\n  const api = useApi();\n  return useMutation<void, Error, string>({\n    mutationFn: (uri) => api.deleteValidationSet(uri),\n    onSuccess: () => {\n      void queryClient.invalidateQueries({\n        queryKey: validationQueryKeys.sets(),\n      });\n    },\n  });\n};\n\n/**\n * Hook to rename a validation set.\n */\nexport const useRenameValidationSet = () => {\n  const queryClient = useQueryClient();\n  const api = useApi();\n  return useMutation<string, Error, { uri: string; newName: string }>({\n    mutationFn: ({ uri, newName }) => api.renameValidationSet(uri, newName),\n    onSuccess: () => {\n      void queryClient.invalidateQueries({\n        queryKey: validationQueryKeys.sets(),\n      });\n    },\n  });\n};\n","import type { ValidationCase } from \"../../types/api-types\";\n\n/** Valid file extensions for validation set files */\nexport const VALIDATION_SET_EXTENSIONS = [\n  \".csv\",\n  \".json\",\n  \".jsonl\",\n  \".yml\",\n  \".yaml\",\n];\n\n/**\n * Check if a filename has a valid validation set extension.\n */\nexport const hasValidationSetExtension = (name: string): boolean => {\n  const lower = name.toLowerCase();\n  return VALIDATION_SET_EXTENSIONS.some((ext) => lower.endsWith(ext));\n};\n\n/**\n * Converts a validation case ID to a display string.\n * Handles both single string IDs and composite (array) IDs.\n */\nexport const getIdText = (id: string | string[]): string => {\n  return Array.isArray(id) ? id.join(\", \") : id;\n};\n\n/**\n * Converts a validation case ID to a unique key for use in Maps/Sets.\n * Uses \"|\" as separator for composite IDs.\n */\nexport const getCaseKey = (id: string | string[]): string => {\n  return Array.isArray(id) ? id.join(\"|\") : id;\n};\n\n/**\n * Extracts unique label keys from a list of validation cases.\n * Returns sorted array of label key names.\n */\nexport const extractUniqueLabels = (cases: ValidationCase[]): string[] => {\n  const labelKeys = new Set<string>();\n  for (const c of cases) {\n    if (c.labels) {\n      for (const key of Object.keys(c.labels)) {\n        labelKeys.add(key);\n      }\n    }\n  }\n  return Array.from(labelKeys).sort();\n};\n\n/**\n * Extracts unique split values from a list of validation cases.\n * Returns sorted array of non-empty split values.\n */\nexport const extractUniqueSplits = (cases: ValidationCase[]): string[] => {\n  const splitSet = new Set<string>();\n  for (const c of cases) {\n    if (c.split) {\n      splitSet.add(c.split);\n    }\n  }\n  return Array.from(splitSet).sort();\n};\n\n/**\n * Extracts the filename from a URI/path.\n * @param uri - The full URI or path\n * @param stripExtension - If true, removes common validation file extensions\n */\nexport const getFilenameFromUri = (\n  uri: string,\n  stripExtension = false\n): string => {\n  const filename = uri.split(\"/\").pop() ?? uri;\n  if (stripExtension) {\n    return filename.replace(/\\.(csv|json|jsonl|yaml|yml)$/i, \"\");\n  }\n  return filename;\n};\n\n/**\n * Extracts the directory portion of a URI (everything before the filename).\n * @param uri - The full URI (e.g., \"file:///path/to/file.csv\")\n * @returns The directory URI without trailing slash\n */\nexport const getDirFromUri = (uri: string): string => {\n  const parts = uri.split(\"/\");\n  parts.pop(); // Remove filename\n  return parts.join(\"/\");\n};\n\n/**\n * Generates a new file URI in the same directory as the source with given name.\n * @param sourceUri - The source file URI\n * @param newName - The new filename (without extension)\n * @returns New file URI with .csv extension\n */\nexport const generateNewSetUri = (\n  sourceUri: string,\n  newName: string\n): string => {\n  const dir = getDirFromUri(sourceUri);\n  return `${dir}/${newName}.csv`;\n};\n\n/** Characters that are not allowed in filenames */\nconst INVALID_FILENAME_CHARS = /[/\\\\:*?\"<>|]/;\n\n/**\n * Validates a filename for invalid characters.\n * @param name - The filename to validate (without extension)\n * @returns Object with isValid and optional error message\n */\nexport const isValidFilename = (\n  name: string\n): { isValid: boolean; error?: string } => {\n  if (!name.trim()) {\n    return { isValid: false, error: \"Name cannot be empty\" };\n  }\n\n  if (INVALID_FILENAME_CHARS.test(name)) {\n    return {\n      isValid: false,\n      error: 'Name contains invalid characters: / \\\\ : * ? \" < > |',\n    };\n  }\n\n  if (name.startsWith(\".\")) {\n    return { isValid: false, error: \"Name cannot start with a dot\" };\n  }\n\n  if (name.length > 255) {\n    return { isValid: false, error: \"Name is too long (max 255 characters)\" };\n  }\n\n  return { isValid: true };\n};\n","import { RefCallback, useCallback, useEffect, useState } from \"react\";\n\ntype DropdownPosition = \"above\" | \"below\";\n\ninterface UseDropdownPositionOptions {\n  /** Number of options in the dropdown */\n  optionCount: number;\n  /** Height of each option in pixels (default: 22, from vscode-elements) */\n  optionHeight?: number;\n  /** Maximum number of visible options before scrolling (default: 10, from vscode-elements) */\n  maxVisibleOptions?: number;\n  /** Additional padding for the dropdown (default: 8) */\n  padding?: number;\n}\n\ninterface UseDropdownPositionResult {\n  /** Ref callback to attach to the dropdown container element */\n  ref: RefCallback<HTMLElement>;\n  /** Computed position for the dropdown: 'above' or 'below' */\n  position: DropdownPosition;\n}\n\n/**\n * Hook that determines optimal dropdown position based on available viewport space.\n *\n * Calculates whether a dropdown should open above or below its trigger element\n * by measuring available space and estimated dropdown height. Updates on window\n * resize and scroll events.\n *\n * @param options - Configuration for dropdown sizing\n * @returns Object containing ref callback and computed position\n *\n * @example\n * ```tsx\n * const { ref, position } = useDropdownPosition({ optionCount: 10 });\n * return (\n *   <div ref={ref}>\n *     <Dropdown position={position} />\n *   </div>\n * );\n * ```\n */\nexport function useDropdownPosition(\n  options: UseDropdownPositionOptions\n): UseDropdownPositionResult {\n  const {\n    optionCount,\n    optionHeight = 22,\n    maxVisibleOptions = 10,\n    padding = 8,\n  } = options;\n\n  const [element, setElement] = useState<HTMLElement | null>(null);\n  const [position, setPosition] = useState<DropdownPosition>(\"below\");\n\n  const ref: RefCallback<HTMLElement> = useCallback(\n    (node: HTMLElement | null) => {\n      setElement(node);\n    },\n    []\n  );\n\n  useEffect(() => {\n    if (!element) {\n      return;\n    }\n\n    const calculatePosition = (): void => {\n      const rect = element.getBoundingClientRect();\n      const spaceBelow = window.innerHeight - rect.bottom;\n      const visibleOptions = Math.min(optionCount, maxVisibleOptions);\n      const estimatedHeight = visibleOptions * optionHeight + padding;\n\n      setPosition(spaceBelow >= estimatedHeight ? \"below\" : \"above\");\n    };\n\n    // Calculate initial position\n    calculatePosition();\n\n    // Debounce handler for resize and scroll events\n    let timeoutId: ReturnType<typeof setTimeout> | null = null;\n    const debouncedCalculate = (): void => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n      timeoutId = setTimeout(calculatePosition, 100);\n    };\n\n    window.addEventListener(\"resize\", debouncedCalculate);\n    window.addEventListener(\"scroll\", debouncedCalculate, true);\n\n    return () => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n      window.removeEventListener(\"resize\", debouncedCalculate);\n      window.removeEventListener(\"scroll\", debouncedCalculate, true);\n    };\n  }, [element, optionCount, optionHeight, maxVisibleOptions, padding]);\n\n  return { ref, position };\n}\n","import { VscodeTextfield } from \"@vscode-elements/react-elements\";\nimport { FC, useState, useRef, useEffect, useMemo } from \"react\";\nimport { createPortal } from \"react-dom\";\n\nimport { Modal } from \"../../../components/Modal\";\nimport { AppConfig } from \"../../../types/api-types\";\nimport { dirname } from \"../../../utils/path\";\nimport { projectOrAppAliasedPath } from \"../../server/useAppConfig\";\nimport {\n  getFilenameFromUri,\n  hasValidationSetExtension,\n  VALIDATION_SET_EXTENSIONS,\n} from \"../utils\";\n\nimport styles from \"./ValidationSetSelector.module.css\";\n\ninterface ValidationSetSelectorProps {\n  validationSets: string[];\n  selectedUri: string | undefined;\n  onSelect: (uri: string | undefined) => void;\n  /** Size trigger to fit longest option (default: false) */\n  autoSize?: boolean;\n\n  /** Adds a create new option the dropown */\n  allowCreate?: boolean;\n  onCreate?: (name: string) => void;\n\n  /** Project directory path for displaying full file path in create modal */\n  appConfig?: AppConfig;\n}\n\n/**\n * Select-box component for selecting validation sets.\n * Shows collapsed trigger with 2-line display (filename + path).\n * Opens dropdown on click with keyboard navigation support.\n */\nexport const ValidationSetSelector: FC<ValidationSetSelectorProps> = ({\n  validationSets,\n  selectedUri,\n  onSelect,\n  autoSize = false,\n  allowCreate = false,\n  onCreate,\n  appConfig,\n}) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [dropdownStyle, setDropdownStyle] = useState<React.CSSProperties>({});\n  const containerRef = useRef<HTMLDivElement>(null);\n  const triggerRef = useRef<HTMLButtonElement>(null);\n  const dropdownRef = useRef<HTMLDivElement>(null);\n\n  // Modal state for creating new set\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [newSetName, setNewSetName] = useState(\"\");\n  const [validationError, setValidationError] = useState<string | null>(null);\n\n  // Extract display name from URI (last part of path with extension)\n  const getDisplayName = (uri: string): string => {\n    return getFilenameFromUri(uri);\n  };\n\n  // Find the longest display name for sizing\n  const longestDisplayName = useMemo(() => {\n    if (validationSets.length === 0) return \"\";\n    return validationSets.reduce((longest, uri) => {\n      const name = getDisplayName(uri);\n      return name.length > longest.length ? name : longest;\n    }, \"\");\n  }, [validationSets]);\n\n  const getDisplayPath = (uri: string, appConfig?: AppConfig): string => {\n    let path = appConfig\n      ? projectOrAppAliasedPath(appConfig, dirname(uri))\n      : dirname(uri);\n    // Strip file:// prefix for cleaner display\n    if (path && path.startsWith(\"file://\")) {\n      path = path.slice(7);\n    }\n    return path ?? uri;\n  };\n\n  // Update dropdown position when opening\n  useEffect(() => {\n    if (isOpen && triggerRef.current) {\n      const rect = triggerRef.current.getBoundingClientRect();\n      setDropdownStyle({\n        position: \"fixed\",\n        top: rect.bottom + 2,\n        left: rect.left,\n        width: rect.width,\n      });\n    }\n  }, [isOpen]);\n\n  // Close dropdown when trigger resizes to prevent orphaned positioning\n  useEffect(() => {\n    if (!isOpen || !triggerRef.current) return;\n\n    let initialCall = true;\n    const observer = new ResizeObserver(() => {\n      // Skip the initial callback that fires when observe() is called\n      if (initialCall) {\n        initialCall = false;\n        return;\n      }\n      setIsOpen(false);\n    });\n\n    observer.observe(triggerRef.current);\n    return () => observer.disconnect();\n  }, [isOpen]);\n\n  // Close on click outside (check both container and dropdown since dropdown is in portal)\n  useEffect(() => {\n    const handleClickOutside = (e: MouseEvent) => {\n      const target = e.target as Node;\n      const isOutsideContainer =\n        containerRef.current && !containerRef.current.contains(target);\n      const isOutsideDropdown =\n        dropdownRef.current && !dropdownRef.current.contains(target);\n\n      if (isOutsideContainer && isOutsideDropdown) {\n        setIsOpen(false);\n      }\n    };\n    if (isOpen) {\n      document.addEventListener(\"mousedown\", handleClickOutside);\n      return () =>\n        document.removeEventListener(\"mousedown\", handleClickOutside);\n    }\n  }, [isOpen]);\n\n  const handleSelect = (uri: string) => {\n    if (uri === \"__create_new__\") {\n      setShowCreateModal(true);\n      setNewSetName(\"\");\n      setValidationError(null);\n      setIsOpen(false);\n    } else {\n      onSelect(uri);\n      setIsOpen(false);\n    }\n  };\n\n  // Check if a name has an extension (any extension, valid or not)\n  const hasAnyExtension = (name: string): boolean => {\n    const lastDot = name.lastIndexOf(\".\");\n    // Has extension if there's a dot that's not at the start and has chars after it\n    return lastDot > 0 && lastDot < name.length - 1;\n  };\n\n  // Check if a name is starting to type an extension (has a dot)\n  const isTypingExtension = (name: string): boolean => {\n    const lastDot = name.lastIndexOf(\".\");\n    return lastDot > 0; // Has a dot that's not at the start\n  };\n\n  // Check if the partial extension could be the start of a valid extension\n  const isValidPartialExtension = (name: string): boolean => {\n    const lastDot = name.lastIndexOf(\".\");\n    if (lastDot <= 0) return true; // No extension being typed\n\n    const partialExt = name.slice(lastDot).toLowerCase();\n    // Check if any valid extension starts with what the user has typed\n    return VALIDATION_SET_EXTENSIONS.some((ext) => ext.startsWith(partialExt));\n  };\n\n  // Get the extension validation error for real-time feedback\n  const getExtensionError = (name: string): string | null => {\n    const trimmed = name.trim();\n    if (!trimmed) return null;\n\n    // If user is typing an extension that can't match any valid extension\n    if (isTypingExtension(trimmed) && !isValidPartialExtension(trimmed)) {\n      return `Invalid extension. Valid extensions: ${VALIDATION_SET_EXTENSIONS.join(\", \")}`;\n    }\n\n    return null;\n  };\n\n  // Modal handlers\n  const handleNameInput = (e: Event) => {\n    setNewSetName((e.target as HTMLInputElement).value);\n    setValidationError(null);\n  };\n\n  const handleCreateSubmit = () => {\n    const trimmedName = newSetName.trim();\n    if (!trimmedName) return;\n\n    // Check if user provided an extension that's not valid\n    if (\n      hasAnyExtension(trimmedName) &&\n      !hasValidationSetExtension(trimmedName)\n    ) {\n      setValidationError(\n        `Invalid extension. Valid extensions: ${VALIDATION_SET_EXTENSIONS.join(\", \")}`\n      );\n      return;\n    }\n\n    onCreate?.(trimmedName);\n    setShowCreateModal(false);\n    setNewSetName(\"\");\n    setValidationError(null);\n  };\n\n  const handleModalClose = () => {\n    setShowCreateModal(false);\n    setNewSetName(\"\");\n    setValidationError(null);\n  };\n\n  // Keyboard navigation\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (!isOpen) {\n      if (e.key === \"Enter\" || e.key === \" \" || e.key === \"ArrowDown\") {\n        e.preventDefault();\n        setIsOpen(true);\n      }\n      return;\n    }\n\n    const currentIndex = selectedUri ? validationSets.indexOf(selectedUri) : -1;\n\n    if (e.key === \"ArrowDown\") {\n      e.preventDefault();\n      const nextIndex = Math.min(currentIndex + 1, validationSets.length - 1);\n      onSelect(validationSets[nextIndex]);\n    } else if (e.key === \"ArrowUp\") {\n      e.preventDefault();\n      const prevIndex = Math.max(currentIndex - 1, 0);\n      onSelect(validationSets[prevIndex]);\n    } else if (e.key === \"Escape\") {\n      setIsOpen(false);\n    } else if (e.key === \"Enter\") {\n      setIsOpen(false);\n    }\n  };\n\n  // If any of the items will show a non-root dir, show paths\n  // spacing for all of them\n  const hasNonRootDir = validationSets.some((uri) => {\n    return !!getDisplayPath(uri, appConfig);\n  });\n\n  const dropdown = isOpen ? (\n    <div\n      ref={dropdownRef}\n      className={styles.dropdown}\n      style={dropdownStyle}\n      role=\"listbox\"\n    >\n      {validationSets.map((uri) => (\n        <div\n          key={uri}\n          role=\"option\"\n          aria-selected={selectedUri === uri}\n          className={`${styles.item} ${selectedUri === uri ? styles.selected : \"\"}`}\n          onClick={() => handleSelect(uri)}\n        >\n          <div className={styles.primaryText}>{getDisplayName(uri)}</div>\n          <div className={styles.secondaryText}>\n            {getDisplayPath(uri, appConfig) || (hasNonRootDir ? \"\\u00A0\" : \"\")}\n          </div>\n        </div>\n      ))}\n\n      {/* Create new set option */}\n      {allowCreate && onCreate && (\n        <>\n          {validationSets.length > 0 && <div className={styles.divider} />}\n          <div\n            role=\"option\"\n            aria-selected={false}\n            className={`${styles.item} ${styles.createOption}`}\n            onClick={() => handleSelect(\"__create_new__\")}\n          >\n            <div className={styles.primaryText}>Create new set...</div>\n          </div>\n        </>\n      )}\n    </div>\n  ) : null;\n\n  return (\n    <>\n      <div ref={containerRef} className={styles.container}>\n        {/* Trigger button - shows selected item */}\n        <button\n          ref={triggerRef}\n          className={styles.trigger}\n          onClick={() => setIsOpen(!isOpen)}\n          onKeyDown={handleKeyDown}\n          aria-expanded={isOpen}\n          aria-haspopup=\"listbox\"\n        >\n          <div className={styles.triggerContent}>\n            {/* Hidden sizer to set min-width based on longest option */}\n            {autoSize && (\n              <span className={styles.triggerSizer} aria-hidden=\"true\">\n                {longestDisplayName}\n              </span>\n            )}\n            {selectedUri ? (\n              <span className={styles.triggerPrimary}>\n                {getDisplayName(selectedUri)}\n              </span>\n            ) : (\n              <span className={styles.triggerPlaceholder}>\n                Select validation set...\n              </span>\n            )}\n          </div>\n          <span className={styles.chevron} aria-hidden=\"true\">\n            âŒƒ\n          </span>\n        </button>\n\n        {/* Dropdown rendered via portal to escape clipping */}\n        {createPortal(dropdown, document.body)}\n      </div>\n\n      {/* Create new set modal */}\n      <Modal\n        show={showCreateModal}\n        onHide={handleModalClose}\n        onSubmit={newSetName.trim() ? handleCreateSubmit : undefined}\n        title=\"Create New Validation Set\"\n        footer={\n          <>\n            <button className={styles.modalButton} onClick={handleModalClose}>\n              Cancel\n            </button>\n            <button\n              className={`${styles.modalButton} ${styles.modalButtonPrimary}`}\n              onClick={handleCreateSubmit}\n              disabled={!newSetName.trim()}\n            >\n              Create\n            </button>\n          </>\n        }\n      >\n        <div className={styles.modalContent}>\n          <p>Enter a name for the new validation set:</p>\n          <VscodeTextfield\n            value={newSetName}\n            onInput={handleNameInput}\n            placeholder=\"validation-set-name\"\n            data-autofocus\n          />\n          {(() => {\n            const trimmedName = newSetName.trim();\n            const extensionError = getExtensionError(trimmedName);\n            const displayError = validationError || extensionError;\n            const displayDir = appConfig?.project_dir?.startsWith(\"file://\")\n              ? appConfig?.project_dir.slice(7)\n              : appConfig?.project_dir;\n\n            // Show hint only if no error and we have a name and projectDir\n            if (trimmedName && !displayError && displayDir) {\n              // If user is providing any extension, use their filename as-is\n              // Otherwise append .csv\n              const filename = isTypingExtension(trimmedName)\n                ? trimmedName\n                : `${trimmedName}.csv`;\n              return (\n                <span className={styles.hint}>\n                  {displayDir}/{filename}\n                </span>\n              );\n            }\n\n            // Show error if present\n            if (displayError) {\n              return <span className={styles.error}>{displayError}</span>;\n            }\n\n            return null;\n          })()}\n        </div>\n      </Modal>\n    </>\n  );\n};\n","import {\n  VscodeOption,\n  VscodeSingleSelect,\n  VscodeTextfield,\n} from \"@vscode-elements/react-elements\";\nimport { FC, useMemo, useState } from \"react\";\n\nimport { Modal } from \"../../../components/Modal\";\nimport { useDropdownPosition } from \"../../../hooks/useDropdownPosition\";\n\nimport styles from \"./ValidationSplitSelector.module.css\";\n\ninterface ValidationSplitSelectorProps {\n  /** Current split value (null means no split) */\n  value: string | null;\n  /** Available splits for the dropdown */\n  existingSplits: string[];\n  /** Callback when split changes */\n  onChange: (split: string | null) => void;\n  /** Disable the selector */\n  disabled?: boolean;\n  /** Additional className for the select element */\n  className?: string;\n  /** Label for \"no split\" option */\n  noSplitLabel?: string;\n  /** Label for \"new split\" option */\n  newSplitLabel?: string;\n}\n\n/**\n * Reusable split selector component with built-in \"New Split\" modal.\n * Style-agnostic: consumers control styling via className prop.\n */\nexport const ValidationSplitSelector: FC<ValidationSplitSelectorProps> = ({\n  value,\n  existingSplits,\n  onChange,\n  disabled = false,\n  className,\n  noSplitLabel = \"(Optional)\",\n  newSplitLabel = \"New split...\",\n}) => {\n  // Internal modal state\n  const [showCustomModal, setShowCustomModal] = useState(false);\n  const [customSplitValue, setCustomSplitValue] = useState(\"\");\n\n  // Ensure current value is always in the options list.\n  // This prevents the dropdown from showing \"(No split)\" during React Query\n  // cache transitions when the cases data is temporarily stale.\n  const effectiveSplits = useMemo(() => {\n    if (value && !existingSplits.includes(value)) {\n      return [...existingSplits, value].sort();\n    }\n    return existingSplits;\n  }, [existingSplits, value]);\n\n  // Auto-position dropdown based on available viewport space\n  // Option count: 1 (no split) + splits + 1 (new split)\n  const { ref, position } = useDropdownPosition({\n    optionCount: effectiveSplits.length + 2,\n  });\n\n  // Map null to internal sentinel value for the select\n  const selectValue = value ?? \"__none__\";\n\n  const handleSelectChange = (e: Event) => {\n    const newValue = (e.target as HTMLSelectElement).value;\n    if (newValue === \"__custom__\") {\n      setShowCustomModal(true);\n      setCustomSplitValue(\"\");\n    } else if (newValue === \"__none__\") {\n      onChange(null);\n    } else {\n      onChange(newValue);\n    }\n  };\n\n  const handleCustomInput = (e: Event) => {\n    setCustomSplitValue((e.target as HTMLInputElement).value);\n  };\n\n  const handleCustomSubmit = () => {\n    if (customSplitValue.trim()) {\n      onChange(customSplitValue.trim());\n    }\n    setShowCustomModal(false);\n    setCustomSplitValue(\"\");\n  };\n\n  const handleModalClose = () => {\n    setShowCustomModal(false);\n    setCustomSplitValue(\"\");\n  };\n\n  return (\n    <>\n      <div ref={ref}>\n        <VscodeSingleSelect\n          value={selectValue}\n          onChange={handleSelectChange}\n          className={className}\n          disabled={disabled}\n          position={position}\n        >\n          <VscodeOption value=\"__none__\">{noSplitLabel}</VscodeOption>\n          {effectiveSplits.map((s) => (\n            <VscodeOption key={s} value={s}>\n              {s}\n            </VscodeOption>\n          ))}\n          <VscodeOption value=\"__custom__\">{newSplitLabel}</VscodeOption>\n        </VscodeSingleSelect>\n      </div>\n\n      <Modal\n        show={showCustomModal}\n        onHide={handleModalClose}\n        onSubmit={customSplitValue.trim() ? handleCustomSubmit : undefined}\n        title=\"New Split\"\n        footer={\n          <>\n            <button className={styles.modalButton} onClick={handleModalClose}>\n              Cancel\n            </button>\n            <button\n              className={`${styles.modalButton} ${styles.modalButtonPrimary}`}\n              onClick={handleCustomSubmit}\n              disabled={!customSplitValue.trim()}\n            >\n              Create\n            </button>\n          </>\n        }\n      >\n        <div className={styles.modalContent}>\n          <p>Enter a name for the new split:</p>\n          <VscodeTextfield\n            value={customSplitValue}\n            onInput={handleCustomInput}\n            placeholder=\"Split name\"\n            data-autofocus\n          />\n        </div>\n      </Modal>\n    </>\n  );\n};\n"],"names":["error","useState","useCallback","useEffect","useRef","useMemo","appConfig","dropdown","jsxs","styles","jsx","Fragment","createPortal"],"mappings":"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"}