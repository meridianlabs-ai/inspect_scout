{"version":3,"file":"useFilterBarHandlers.js","sources":["../../src/app/components/columnFilter/ColumnFilterButton.tsx","../../src/app/components/columnFilter/DurationInput.tsx","../../src/app/components/columnFilter/ColumnFilterEditor.tsx","../../src/utils/date.ts","../../src/app/components/columnFilter/useColumnFilter.ts","../../src/app/components/columnFilter/useColumnFilterPopover.ts","../../src/app/components/columnFilter/useAddFilterPopover.ts","../../src/app/components/AddFilterButton.tsx","../../src/app/components/ChipGroup.tsx","../../src/app/components/ColumnPickerButton.tsx","../../src/app/components/ColumnsPopover.tsx","../../src/app/components/FilterBar.tsx","../../src/app/components/useFilterBarHandlers.ts"],"sourcesContent":["import clsx from \"clsx\";\nimport { forwardRef } from \"react\";\n\nimport { ApplicationIcons } from \"../../../components/icons\";\n\nimport styles from \"./ColumnFilterButton.module.css\";\n\nexport interface ColumnFilterButtonProps {\n  columnId: string;\n  isActive: boolean;\n  onClick: (event: React.MouseEvent<HTMLButtonElement>) => void;\n}\n\nexport const ColumnFilterButton = forwardRef<\n  HTMLButtonElement,\n  ColumnFilterButtonProps\n>(({ columnId, isActive, onClick }, ref) => {\n  return (\n    <button\n      ref={ref}\n      type=\"button\"\n      className={clsx(\n        styles.filterButton,\n        isActive && styles.filterButtonActive\n      )}\n      onClick={onClick}\n      aria-label={`Filter ${columnId}`}\n    >\n      <i className={ApplicationIcons.filter} />\n    </button>\n  );\n});\n\nColumnFilterButton.displayName = \"ColumnFilterButton\";\n","import { ChangeEvent, FC, useMemo } from \"react\";\n\nimport { formatTime } from \"../../../utils/format\";\n\nimport styles from \"./ColumnFilterEditor.module.css\";\n\nexport interface DurationInputProps {\n  id: string;\n  value: string;\n  onChange: (event: ChangeEvent<HTMLInputElement>) => void;\n  disabled?: boolean;\n  autoFocus?: boolean;\n}\n\nexport const DurationInput: FC<DurationInputProps> = ({\n  id,\n  value,\n  onChange,\n  disabled,\n  autoFocus,\n}) => {\n  const parsedSeconds = useMemo(() => {\n    const num = Number(value);\n    return Number.isFinite(num) && num >= 0 ? num : null;\n  }, [value]);\n\n  return (\n    <div className={styles.durationInputWrapper}>\n      <input\n        id={id}\n        className={styles.filterInput}\n        type=\"number\"\n        spellCheck=\"false\"\n        value={value}\n        onChange={onChange}\n        placeholder=\"Seconds\"\n        disabled={disabled}\n        step=\"any\"\n        min=\"0\"\n        autoFocus={autoFocus}\n      />\n      {parsedSeconds !== null && (\n        <div className={styles.durationHelper}>{formatTime(parsedSeconds)}</div>\n      )}\n    </div>\n  );\n};\n","import clsx from \"clsx\";\nimport { ChangeEvent, FC, KeyboardEvent, useCallback } from \"react\";\n\nimport { ScalarValue } from \"../../../api/api\";\nimport { AutocompleteInput } from \"../../../components/AutocompleteInput\";\nimport type { OperatorModel } from \"../../../query\";\nimport type { FilterType } from \"../../../state/store\";\n\nimport styles from \"./ColumnFilterEditor.module.css\";\nimport { DurationInput } from \"./DurationInput\";\n\nexport interface AvailableColumn {\n  id: string;\n  label: string;\n  filterType: FilterType;\n}\n\nexport interface ColumnFilterEditorProps {\n  columnId: string;\n  filterType: FilterType;\n  operator: OperatorModel;\n  operatorOptions: OperatorModel[];\n  rawValue: string;\n  /** Second value for BETWEEN/NOT BETWEEN operators */\n  rawValue2?: string;\n  isValueDisabled: boolean;\n  /** True if operator expects a range with two values (BETWEEN, NOT BETWEEN) */\n  isRangeOperator?: boolean;\n  onOperatorChange: (operator: OperatorModel) => void;\n  onValueChange: (value: string) => void;\n  /** Handler for second value changes (BETWEEN operators) */\n  onValue2Change?: (value: string) => void;\n  onCommit?: () => void;\n  onCancel?: () => void;\n  suggestions?: ScalarValue[];\n  // Add mode props\n  mode?: \"add\" | \"edit\";\n  columns?: AvailableColumn[];\n  onColumnChange?: (columnId: string) => void;\n}\n\nexport const ColumnFilterEditor: FC<ColumnFilterEditorProps> = ({\n  columnId,\n  filterType,\n  operator,\n  operatorOptions,\n  rawValue,\n  rawValue2 = \"\",\n  isValueDisabled,\n  isRangeOperator = false,\n  onOperatorChange,\n  onValueChange,\n  onValue2Change,\n  onCommit,\n  onCancel,\n  suggestions = [],\n  mode = \"edit\",\n  columns,\n  onColumnChange,\n}) => {\n  const isAddMode = mode === \"add\";\n  const hasColumnSelected = isAddMode ? !!columnId : true;\n  // In add mode, show dropdown only until a column is selected\n  const showColumnDropdown = isAddMode && !columnId;\n\n  // Get the display label for the selected column\n  const selectedColumnLabel = columnId\n    ? (columns?.find((col) => col.id === columnId)?.label ?? columnId)\n    : \"\";\n\n  const handleColumnSelectChange = useCallback(\n    (event: ChangeEvent<HTMLSelectElement>) => {\n      onColumnChange?.(event.target.value);\n    },\n    [onColumnChange]\n  );\n  const handleOperatorChange = useCallback(\n    (event: ChangeEvent<HTMLSelectElement>) => {\n      const operator = event.target.value as OperatorModel;\n      onOperatorChange(operator);\n    },\n    [onOperatorChange]\n  );\n\n  const handleValueChange = useCallback(\n    (event: ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {\n      const value = event.target.value;\n      onValueChange(value);\n    },\n    [onValueChange]\n  );\n\n  const handleValue2Change = useCallback(\n    (event: ChangeEvent<HTMLInputElement>) => {\n      const value = event.target.value;\n      onValue2Change?.(value);\n    },\n    [onValue2Change]\n  );\n\n  const handleKeyDown = useCallback(\n    (event: KeyboardEvent) => {\n      // Prevent parent bubbling\n      event.stopPropagation();\n\n      if (event.key === \"Escape\") {\n        event.preventDefault();\n        onCancel?.();\n      }\n      if (event.key === \"Enter\") {\n        event.preventDefault();\n        onCommit?.();\n      }\n    },\n    [onCancel, onCommit]\n  );\n\n  return (\n    <div className={styles.filterContent} onKeyDown={handleKeyDown}>\n      {/* Column row - dropdown until selected, then static text */}\n      <div\n        className={clsx(\n          styles.filterRow,\n          styles.columnId,\n          !showColumnDropdown && styles.columnIdText,\n          \"text-size-small\"\n        )}\n      >\n        {showColumnDropdown ? (\n          <select\n            id=\"column-select\"\n            className={styles.filterSelect}\n            value={columnId}\n            onChange={handleColumnSelectChange}\n            autoFocus\n          >\n            <option value=\"\">Select column...</option>\n            {columns?.map((col) => (\n              <option key={col.id} value={col.id}>\n                {col.label}\n              </option>\n            ))}\n          </select>\n        ) : (\n          selectedColumnLabel\n        )}\n      </div>\n\n      {/* Operator and value rows - only show when column is selected */}\n      {hasColumnSelected && (\n        <>\n          <div className={styles.filterRow}>\n            <select\n              id={`${columnId}-op`}\n              className={styles.filterSelect}\n              value={operator}\n              onChange={handleOperatorChange}\n            >\n              {operatorOptions.map((option) => (\n                <option key={option} value={option}>\n                  {option}\n                </option>\n              ))}\n            </select>\n          </div>\n          {isRangeOperator && <span className={styles.rangeLabel}>Start</span>}\n          <div className={styles.filterRow}>\n            {filterType === \"boolean\" ? (\n              <select\n                id={`${columnId}-val`}\n                className={styles.filterSelect}\n                value={rawValue}\n                onChange={handleValueChange}\n                disabled={isValueDisabled}\n                autoFocus={!isAddMode}\n              >\n                <option value=\"\">(not set)</option>\n                <option value=\"true\">true</option>\n                <option value=\"false\">false</option>\n              </select>\n            ) : filterType === \"string\" || filterType === \"unknown\" ? (\n              <AutocompleteInput\n                id={`${columnId}-val`}\n                value={rawValue}\n                onChange={onValueChange}\n                onCommit={onCommit}\n                onCancel={onCancel}\n                disabled={isValueDisabled}\n                placeholder=\"Filter\"\n                suggestions={suggestions}\n                className={styles.filterInput}\n                autoFocus={!isAddMode}\n                allowBrowse={true}\n              />\n            ) : filterType === \"duration\" ? (\n              <DurationInput\n                id={`${columnId}-val`}\n                value={rawValue}\n                onChange={handleValueChange}\n                disabled={isValueDisabled}\n                autoFocus={!isAddMode}\n              />\n            ) : (\n              <input\n                id={`${columnId}-val`}\n                className={styles.filterInput}\n                type={\n                  filterType === \"number\"\n                    ? \"number\"\n                    : filterType === \"date\"\n                      ? \"date\"\n                      : \"datetime-local\"\n                }\n                spellCheck=\"false\"\n                value={rawValue}\n                onChange={handleValueChange}\n                placeholder=\"Filter\"\n                disabled={isValueDisabled}\n                step={filterType === \"number\" ? \"any\" : undefined}\n                autoFocus={!isAddMode}\n              />\n            )}\n          </div>\n          {/* Second input for BETWEEN/NOT BETWEEN operators */}\n          {isRangeOperator && (\n            <>\n              <span className={styles.rangeLabel}>End</span>\n              <div className={styles.filterRow}>\n                {filterType === \"duration\" ? (\n                  <DurationInput\n                    id={`${columnId}-val2`}\n                    value={rawValue2}\n                    onChange={handleValue2Change}\n                    disabled={isValueDisabled}\n                  />\n                ) : (\n                  <input\n                    id={`${columnId}-val2`}\n                    className={styles.filterInput}\n                    type={\n                      filterType === \"number\"\n                        ? \"number\"\n                        : filterType === \"date\"\n                          ? \"date\"\n                          : \"datetime-local\"\n                    }\n                    spellCheck=\"false\"\n                    value={rawValue2}\n                    onChange={handleValue2Change}\n                    placeholder=\"Filter\"\n                    disabled={isValueDisabled}\n                    step={filterType === \"number\" ? \"any\" : undefined}\n                  />\n                )}\n              </div>\n            </>\n          )}\n        </>\n      )}\n\n      <div className={styles.filterRow}>\n        <button\n          className={clsx(\n            \"btn\",\n            \"btn-outline-primary\",\n            styles.filterButton,\n            \"text-size-small\"\n          )}\n          onClick={onCommit}\n          disabled={!hasColumnSelected}\n        >\n          Apply\n        </button>\n      </div>\n    </div>\n  );\n};\n","/**\n * Utilities for working with dates and native HTML5 date/datetime inputs.\n */\n\n/**\n * Formats a date value for use with native HTML5 date input (type=\"date\").\n * Returns format: YYYY-MM-DD\n *\n * @param value - The date value (Date, ISO string, or timestamp)\n * @returns Formatted date string in YYYY-MM-DD format, or empty string if invalid\n */\nexport function formatDateForInput(\n  value: Date | string | number | null | undefined\n): string {\n  if (value === null || value === undefined) {\n    return \"\";\n  }\n\n  const date = new Date(value);\n  if (isNaN(date.getTime())) {\n    return \"\";\n  }\n\n  // Format as YYYY-MM-DD for date input\n  const dateOnly = date.toISOString().split(\"T\")[0];\n  return dateOnly ?? \"\";\n}\n\n/**\n * Formats a datetime value for use with native HTML5 datetime-local input (type=\"datetime-local\").\n * Returns format: YYYY-MM-DDTHH:mm\n *\n * @param value - The datetime value (Date, ISO string, or timestamp)\n * @returns Formatted datetime string in YYYY-MM-DDTHH:mm format, or empty string if invalid\n */\nexport function formatDateTimeForInput(\n  value: Date | string | number | null | undefined\n): string {\n  if (value === null || value === undefined) {\n    return \"\";\n  }\n\n  const date = new Date(value);\n  if (isNaN(date.getTime())) {\n    return \"\";\n  }\n\n  // Format as YYYY-MM-DDTHH:mm for datetime-local input\n  const isoStr = date.toISOString();\n  return isoStr.substring(0, 16); // YYYY-MM-DDTHH:mm\n}\n\n/**\n * Parses a date or datetime string from native HTML5 inputs and returns an ISO string.\n * Handles both date (YYYY-MM-DD) and datetime-local (YYYY-MM-DDTHH:mm) formats.\n *\n * @param value - The date/datetime string from the native input\n * @returns ISO 8601 datetime string, or undefined if invalid\n */\nexport function parseDateFromInput(value: string): string | undefined {\n  if (!value || value.trim() === \"\") {\n    return undefined;\n  }\n\n  const date = new Date(value);\n  if (isNaN(date.getTime())) {\n    return undefined;\n  }\n\n  // Return the ISO string for backend filtering\n  return date.toISOString();\n}\n\n/**\n * Checks if a value is a valid date.\n *\n * @param value - The value to check\n * @returns true if the value is a valid date\n */\nexport function isValidDate(\n  value: Date | string | number | null | undefined\n): boolean {\n  if (value === null || value === undefined) {\n    return false;\n  }\n\n  const date = new Date(value);\n  return !isNaN(date.getTime());\n}\n","import { useCallback, useEffect, useRef, useState } from \"react\";\n\nimport { ConditionBuilder } from \"../../../query\";\nimport type { OperatorModel, ScalarValue } from \"../../../query\";\nimport type { SimpleCondition } from \"../../../query/types\";\nimport type { FilterType } from \"../../../state/store\";\nimport {\n  formatDateForInput,\n  formatDateTimeForInput,\n  parseDateFromInput,\n} from \"../../../utils/date\";\n\nconst OPERATORS_BY_TYPE: Record<FilterType, OperatorModel[]> = {\n  string: [\n    \"=\",\n    \"!=\",\n    \"LIKE\",\n    \"NOT LIKE\",\n    \"ILIKE\",\n    \"NOT ILIKE\",\n    \"IN\",\n    \"NOT IN\",\n    \"IS NULL\",\n    \"IS NOT NULL\",\n  ],\n  number: [\n    \"=\",\n    \"!=\",\n    \"<\",\n    \"<=\",\n    \">\",\n    \">=\",\n    \"IN\",\n    \"NOT IN\",\n    \"BETWEEN\",\n    \"NOT BETWEEN\",\n    \"IS NULL\",\n    \"IS NOT NULL\",\n  ],\n  boolean: [\"=\", \"!=\", \"IS NULL\", \"IS NOT NULL\"],\n  date: [\n    \"=\",\n    \"!=\",\n    \"<\",\n    \"<=\",\n    \">\",\n    \">=\",\n    \"BETWEEN\",\n    \"NOT BETWEEN\",\n    \"IS NULL\",\n    \"IS NOT NULL\",\n  ],\n  datetime: [\n    \"=\",\n    \"!=\",\n    \"<\",\n    \"<=\",\n    \">\",\n    \">=\",\n    \"BETWEEN\",\n    \"NOT BETWEEN\",\n    \"IS NULL\",\n    \"IS NOT NULL\",\n  ],\n  duration: [\n    \"=\",\n    \"!=\",\n    \"<\",\n    \"<=\",\n    \">\",\n    \">=\",\n    \"BETWEEN\",\n    \"NOT BETWEEN\",\n    \"IS NULL\",\n    \"IS NOT NULL\",\n  ],\n  unknown: [\n    \"=\",\n    \"!=\",\n    \"LIKE\",\n    \"NOT LIKE\",\n    \"ILIKE\",\n    \"NOT ILIKE\",\n    \"IN\",\n    \"NOT IN\",\n    \"IS NULL\",\n    \"IS NOT NULL\",\n  ],\n};\n\nconst OPERATORS_WITHOUT_VALUE = new Set<OperatorModel>([\n  \"IS NULL\",\n  \"IS NOT NULL\",\n]);\n\nconst OPERATORS_WITH_LIST_VALUE = new Set<OperatorModel>([\"IN\", \"NOT IN\"]);\n\nconst OPERATORS_WITH_RANGE_VALUE = new Set<OperatorModel>([\n  \"BETWEEN\",\n  \"NOT BETWEEN\",\n]);\n\n/**\n * Formats a single scalar value for display in an input field.\n */\nconst formatScalarValue = (\n  value: ScalarValue,\n  filterType?: FilterType\n): string => {\n  if (value === null || value === undefined) {\n    return \"\";\n  }\n  // For date/datetime types, ensure ISO format for native inputs\n  if (filterType === \"date\" && typeof value !== \"boolean\") {\n    return formatDateForInput(value);\n  }\n  if (filterType === \"datetime\" && typeof value !== \"boolean\") {\n    return formatDateTimeForInput(value);\n  }\n  return String(value);\n};\n\n/**\n * Formats a filter value (single, array, or tuple) for the primary input field.\n * For BETWEEN operators, this returns only the first value.\n */\nconst formatFilterValue = (\n  value: SimpleCondition[\"right\"] | undefined,\n  filterType?: FilterType\n): string => {\n  if (value === null || value === undefined) {\n    return \"\";\n  }\n  // For arrays (IN/NOT IN or BETWEEN tuple), join with comma for IN/NOT IN\n  // or return first value for BETWEEN\n  if (Array.isArray(value)) {\n    // Tuple for BETWEEN - return first value only\n    if (value.length === 2) {\n      return formatScalarValue(value[0], filterType);\n    }\n    // Array for IN/NOT IN - join with comma\n    return value.map((v) => formatScalarValue(v, filterType)).join(\", \");\n  }\n  return formatScalarValue(value, filterType);\n};\n\n/**\n * Formats the second value for BETWEEN operators.\n */\nconst formatFilterValue2 = (\n  value: SimpleCondition[\"right\"] | undefined,\n  filterType?: FilterType\n): string => {\n  if (value === null || value === undefined) {\n    return \"\";\n  }\n  // For BETWEEN tuple, return second value\n  if (Array.isArray(value) && value.length === 2) {\n    return formatScalarValue(value[1], filterType);\n  }\n  return \"\";\n};\n\nconst parseFilterValue = (\n  filterType: FilterType,\n  rawValue: string\n): ScalarValue | undefined => {\n  switch (filterType) {\n    case \"number\":\n    case \"duration\": {\n      const parsed = Number(rawValue);\n      return Number.isFinite(parsed) ? parsed : undefined;\n    }\n    case \"boolean\":\n      if (rawValue === \"true\") return true;\n      if (rawValue === \"false\") return false;\n      return undefined;\n    case \"date\":\n    case \"datetime\":\n      return parseDateFromInput(rawValue);\n    case \"unknown\":\n    case \"string\":\n    default:\n      return rawValue;\n  }\n};\n\n/**\n * Parses a comma-separated string into an array of scalar values for IN/NOT IN operators.\n */\nconst parseListValue = (\n  filterType: FilterType,\n  rawValue: string\n): ScalarValue[] | undefined => {\n  const parts = rawValue\n    .split(\",\")\n    .map((s) => s.trim())\n    .filter((s) => s !== \"\");\n  if (parts.length === 0) {\n    return undefined;\n  }\n  const parsed: ScalarValue[] = [];\n  for (const part of parts) {\n    const value = parseFilterValue(filterType, part);\n    if (value === undefined) {\n      return undefined;\n    }\n    parsed.push(value);\n  }\n  return parsed;\n};\n\n/**\n * Parses two values into a tuple for BETWEEN/NOT BETWEEN operators.\n */\nconst parseRangeValue = (\n  filterType: FilterType,\n  rawValue1: string,\n  rawValue2: string\n): [ScalarValue, ScalarValue] | undefined => {\n  const parsed1 = parseFilterValue(filterType, rawValue1);\n  const parsed2 = parseFilterValue(filterType, rawValue2);\n  if (parsed1 === undefined || parsed2 === undefined) {\n    return undefined;\n  }\n  return [parsed1, parsed2];\n};\n\nexport interface UseColumnFilterParams {\n  columnId: string;\n  filterType: FilterType;\n  condition: SimpleCondition | null;\n  isOpen: boolean;\n}\n\nexport interface UseColumnFilterReturn {\n  operator: OperatorModel;\n  setOperator: (operator: OperatorModel) => void;\n  operatorOptions: OperatorModel[];\n  value: string;\n  setValue: (value: string) => void;\n  /** Second value for BETWEEN/NOT BETWEEN operators */\n  value2: string;\n  setValue2: (value: string) => void;\n  /** True if operator requires no value (IS NULL, IS NOT NULL) */\n  usesValue: boolean;\n  /** True if operator expects a list of values (IN, NOT IN) */\n  usesListValue: boolean;\n  /** True if operator expects a range with two values (BETWEEN, NOT BETWEEN) */\n  usesRangeValue: boolean;\n  buildCondition: (\n    operator: OperatorModel,\n    value: string,\n    value2?: string\n  ) => SimpleCondition | null | undefined;\n}\n\nexport function useColumnFilter({\n  columnId,\n  filterType,\n  condition,\n  isOpen,\n}: UseColumnFilterParams): UseColumnFilterReturn {\n  // operators\n  const operatorOptions = OPERATORS_BY_TYPE[filterType];\n  const defaultOperator: OperatorModel = operatorOptions[0] ?? \"=\";\n  const [operator, setOperator] = useState<OperatorModel>(\n    condition?.operator ?? defaultOperator\n  );\n\n  // value (primary)\n  const [value, setValue] = useState<string>(\n    formatFilterValue(condition?.right, filterType)\n  );\n  // value2 (secondary for BETWEEN operators)\n  const [value2, setValue2] = useState<string>(\n    formatFilterValue2(condition?.right, filterType)\n  );\n\n  const isValueDisabled = OPERATORS_WITHOUT_VALUE.has(operator);\n  const usesListValue = OPERATORS_WITH_LIST_VALUE.has(operator);\n  const usesRangeValue = OPERATORS_WITH_RANGE_VALUE.has(operator);\n\n  const valueSelectRef = useRef<HTMLSelectElement | null>(null);\n  const valueInputRef = useRef<HTMLInputElement | null>(null);\n\n  // Track the previous columnId to detect when we switch to a different filter\n  const prevColumnIdRef = useRef(columnId);\n\n  // Sync state when closed OR when switching to a different column while opening\n  useEffect(() => {\n    const columnChanged = prevColumnIdRef.current !== columnId;\n    prevColumnIdRef.current = columnId;\n\n    if (!isOpen || columnChanged) {\n      // TODO: lint react-hooks/set-state-in-effect - consider if fixing this violation makes sense\n      /* eslint-disable react-hooks/set-state-in-effect */\n      setOperator(condition?.operator ?? defaultOperator);\n      setValue(formatFilterValue(condition?.right, filterType));\n      setValue2(formatFilterValue2(condition?.right, filterType));\n      /* eslint-enable react-hooks/set-state-in-effect */\n    }\n  }, [condition, defaultOperator, filterType, isOpen, columnId, setValue]);\n\n  // auto-focus value input when opened\n  useEffect(() => {\n    if (!isOpen || isValueDisabled) {\n      return;\n    }\n    const timer = window.setTimeout(() => {\n      if (filterType === \"boolean\") {\n        valueSelectRef.current?.focus();\n      } else {\n        valueInputRef.current?.focus();\n      }\n    }, 0);\n    return () => window.clearTimeout(timer);\n  }, [filterType, isOpen, isValueDisabled]);\n\n  const buildCondition = useCallback(\n    (operator: OperatorModel, value: string, value2?: string) => {\n      if (OPERATORS_WITHOUT_VALUE.has(operator)) {\n        return ConditionBuilder.simple(columnId, operator, null);\n      }\n      if (value.trim() === \"\") {\n        return null;\n      }\n\n      // Handle list operators (IN, NOT IN)\n      if (OPERATORS_WITH_LIST_VALUE.has(operator)) {\n        const parsed = parseListValue(filterType, value);\n        if (parsed === undefined) {\n          return undefined;\n        }\n        return ConditionBuilder.simple(columnId, operator, parsed);\n      }\n\n      // Handle range operators (BETWEEN, NOT BETWEEN)\n      if (OPERATORS_WITH_RANGE_VALUE.has(operator)) {\n        if (!value2 || value2.trim() === \"\") {\n          return null;\n        }\n        const parsed = parseRangeValue(filterType, value, value2);\n        if (parsed === undefined) {\n          return undefined;\n        }\n        return ConditionBuilder.simple(columnId, operator, parsed);\n      }\n\n      const parsed = parseFilterValue(filterType, value);\n      if (parsed === undefined) {\n        return undefined;\n      }\n\n      // Special case - inject wildcards if not specified\n      if (\n        operator === \"LIKE\" ||\n        operator === \"NOT LIKE\" ||\n        operator === \"ILIKE\" ||\n        operator === \"NOT ILIKE\"\n      ) {\n        let modified = String(parsed);\n        if (!modified.includes(\"%\")) {\n          modified = `%${modified}%`;\n        }\n        return ConditionBuilder.simple(columnId, operator, modified);\n      } else {\n        return ConditionBuilder.simple(columnId, operator, parsed);\n      }\n    },\n    [columnId, filterType]\n  );\n\n  return {\n    operator,\n    setOperator,\n    value,\n    setValue,\n    value2,\n    setValue2,\n    operatorOptions,\n    usesValue: isValueDisabled,\n    usesListValue,\n    usesRangeValue,\n    buildCondition,\n  };\n}\n","import { useCallback, useEffect, useRef, useState } from \"react\";\n\nimport type { SimpleCondition } from \"../../../query/types\";\nimport type { FilterType } from \"../../../state/store\";\n\nimport { useColumnFilter } from \"./useColumnFilter\";\n\nexport interface UseColumnFilterPopoverParams {\n  columnId: string;\n  filterType: FilterType;\n  condition: SimpleCondition | null;\n  onChange: (condition: SimpleCondition | null) => void;\n}\n\nexport interface UseColumnFilterPopoverReturn {\n  // Popover state\n  isOpen: boolean;\n  setIsOpen: (open: boolean) => void;\n\n  // Filter state from useColumnFilter\n  operator: ReturnType<typeof useColumnFilter>[\"operator\"];\n  setOperator: ReturnType<typeof useColumnFilter>[\"setOperator\"];\n  operatorOptions: ReturnType<typeof useColumnFilter>[\"operatorOptions\"];\n\n  // Value\n  value: ReturnType<typeof useColumnFilter>[\"value\"];\n  setValue: ReturnType<typeof useColumnFilter>[\"setValue\"];\n  value2: ReturnType<typeof useColumnFilter>[\"value2\"];\n  setValue2: ReturnType<typeof useColumnFilter>[\"setValue2\"];\n  isValueDisabled: ReturnType<typeof useColumnFilter>[\"usesValue\"];\n  isRangeOperator: ReturnType<typeof useColumnFilter>[\"usesRangeValue\"];\n\n  // Actions\n  commitAndClose: () => void;\n  cancelAndClose: () => void;\n}\n\nexport function useColumnFilterPopover({\n  columnId,\n  filterType,\n  condition,\n  onChange,\n}: UseColumnFilterPopoverParams): UseColumnFilterPopoverReturn {\n  const [isOpen, setIsOpen] = useState(false);\n  const cancelRef = useRef(false);\n  const prevOpenRef = useRef(false);\n\n  const {\n    operator,\n    setOperator,\n    value,\n    setValue,\n    value2,\n    setValue2,\n    operatorOptions,\n    usesValue: isValueDisabled,\n    usesRangeValue: isRangeOperator,\n    buildCondition,\n  } = useColumnFilter({\n    columnId,\n    filterType,\n    condition,\n    isOpen,\n  });\n\n  const cancelAndClose = useCallback(() => {\n    cancelRef.current = true;\n    setIsOpen(false);\n  }, []);\n\n  const commitAndClose = useCallback(() => {\n    const nextCondition = buildCondition(operator, value, value2);\n    if (nextCondition === undefined) {\n      return;\n    }\n    setIsOpen(false);\n  }, [buildCondition, operator, value, value2]);\n\n  // commit changes when popover closes (unless cancelled)\n  useEffect(() => {\n    if (prevOpenRef.current && !isOpen) {\n      if (cancelRef.current) {\n        cancelRef.current = false;\n      } else {\n        const nextCondition = buildCondition(operator, value, value2);\n        if (nextCondition !== undefined) {\n          onChange(nextCondition);\n        }\n      }\n    }\n    prevOpenRef.current = isOpen;\n  }, [buildCondition, isOpen, onChange, operator, value, value2]);\n\n  return {\n    isOpen,\n    setIsOpen,\n    operator,\n    setOperator,\n    value,\n    setValue,\n    value2,\n    setValue2,\n    operatorOptions,\n    isValueDisabled,\n    isRangeOperator,\n    commitAndClose,\n    cancelAndClose,\n  };\n}\n","import { useCallback, useEffect, useRef, useState } from \"react\";\n\nimport type { OperatorModel } from \"../../../query\";\nimport type { ColumnFilter } from \"../../../state/store\";\n\nimport type { AvailableColumn } from \"./ColumnFilterEditor\";\nimport { useColumnFilter } from \"./useColumnFilter\";\n\nexport interface UseAddFilterPopoverParams {\n  /** Columns available for filtering */\n  columns: AvailableColumn[];\n  /** Current filters */\n  filters: Record<string, ColumnFilter>;\n  /** Callback when a filter is added */\n  onAddFilter: (filter: ColumnFilter) => void;\n  /** Callback when the selected column changes (for fetching suggestions) */\n  onFilterColumnChange?: (columnId: string | null) => void;\n}\n\n/**\n * Generic hook for managing the \"Add Filter\" popover state.\n * Wraps useColumnFilter with column selection and open/close logic.\n */\nexport function useAddFilterPopover({\n  columns,\n  filters,\n  onAddFilter,\n  onFilterColumnChange,\n}: UseAddFilterPopoverParams) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [selectedColumnId, setSelectedColumnId] = useState<string | null>(null);\n  const prevOpenRef = useRef(false);\n\n  const selectedColumn = selectedColumnId\n    ? columns.find((c) => c.id === selectedColumnId)\n    : null;\n  const filterType = selectedColumn?.filterType ?? \"string\";\n\n  const existingFilter = selectedColumnId ? filters[selectedColumnId] : null;\n\n  const {\n    operator,\n    setOperator,\n    value,\n    setValue,\n    value2,\n    setValue2,\n    operatorOptions,\n    usesValue: isValueDisabled,\n    usesRangeValue: isRangeOperator,\n    buildCondition,\n  } = useColumnFilter({\n    columnId: selectedColumnId ?? \"\",\n    filterType,\n    condition: existingFilter?.condition ?? null,\n    isOpen,\n  });\n\n  // Reset column selection when popover opens\n  useEffect(() => {\n    if (isOpen && !prevOpenRef.current) {\n      // TODO: lint react-hooks/set-state-in-effect - consider if fixing this violation makes sense\n      // eslint-disable-next-line react-hooks/set-state-in-effect\n      setSelectedColumnId(null);\n    }\n    prevOpenRef.current = isOpen;\n  }, [isOpen]);\n\n  // Notify parent when popover closes\n  useEffect(() => {\n    if (prevOpenRef.current && !isOpen) {\n      onFilterColumnChange?.(null);\n    }\n  }, [isOpen, onFilterColumnChange]);\n\n  const handleColumnChange = useCallback(\n    (newColumnId: string) => {\n      setSelectedColumnId(newColumnId || null);\n      if (newColumnId) {\n        onFilterColumnChange?.(newColumnId);\n      }\n    },\n    [onFilterColumnChange]\n  );\n\n  const commitAndClose = useCallback(() => {\n    if (!selectedColumnId) return;\n\n    const condition = buildCondition(operator, value, value2);\n    if (condition === undefined) return;\n\n    onAddFilter({ columnId: selectedColumnId, filterType, condition });\n    setIsOpen(false);\n  }, [\n    selectedColumnId,\n    buildCondition,\n    operator,\n    value,\n    value2,\n    onAddFilter,\n    filterType,\n  ]);\n\n  const cancelAndClose = useCallback(() => setIsOpen(false), []);\n\n  return {\n    isOpen,\n    setIsOpen,\n    selectedColumnId,\n    columns,\n    filterType,\n    operator,\n    setOperator: setOperator as (op: OperatorModel) => void,\n    operatorOptions,\n    value,\n    setValue,\n    value2,\n    setValue2,\n    isValueDisabled,\n    isRangeOperator,\n    handleColumnChange,\n    commitAndClose,\n    cancelAndClose,\n  };\n}\n","import { clsx } from \"clsx\";\nimport { FC, useRef } from \"react\";\n\nimport { ScalarValue } from \"../../api/api\";\nimport { ApplicationIcons } from \"../../components/icons\";\nimport { PopOver } from \"../../components/PopOver\";\nimport type { OperatorModel } from \"../../query\";\n\nimport { Chip } from \"./Chip\";\nimport {\n  ColumnFilterEditor,\n  type AvailableColumn,\n} from \"./columnFilter/ColumnFilterEditor\";\nimport styles from \"./FilterBar.module.css\";\n\n/** Props accepted by AddFilterButton - subset of useAddFilterPopover return */\nexport interface AddFilterPopoverState {\n  isOpen: boolean;\n  setIsOpen: (open: boolean) => void;\n  selectedColumnId: string | null;\n  columns: AvailableColumn[];\n  filterType:\n    | \"string\"\n    | \"number\"\n    | \"date\"\n    | \"datetime\"\n    | \"boolean\"\n    | \"duration\"\n    | \"unknown\";\n  operator: OperatorModel;\n  setOperator: (op: OperatorModel) => void;\n  operatorOptions: OperatorModel[];\n  value: string;\n  setValue: (v: string) => void;\n  value2: string;\n  setValue2: (v: string) => void;\n  isValueDisabled: boolean;\n  isRangeOperator: boolean;\n  handleColumnChange: (columnId: string) => void;\n  commitAndClose: () => void;\n  cancelAndClose: () => void;\n}\n\nexport interface AddFilterButtonProps {\n  /** Unique prefix for popover IDs */\n  idPrefix: string;\n  /** Popover state from useAddFilterPopover hook */\n  popoverState: AddFilterPopoverState;\n  /** Suggestions for autocomplete */\n  suggestions?: ScalarValue[];\n}\n\n/**\n * \"Add filter\" chip + popover pattern extracted for reuse.\n * Accepts popover state from useAddFilterPopover hook.\n */\nexport const AddFilterButton: FC<AddFilterButtonProps> = ({\n  idPrefix,\n  popoverState,\n  suggestions = [],\n}) => {\n  const chipRef = useRef<HTMLDivElement | null>(null);\n\n  const {\n    isOpen,\n    setIsOpen,\n    selectedColumnId,\n    columns,\n    filterType,\n    operator,\n    setOperator,\n    operatorOptions,\n    value,\n    setValue,\n    value2,\n    setValue2,\n    isValueDisabled,\n    isRangeOperator,\n    handleColumnChange,\n    commitAndClose,\n    cancelAndClose,\n  } = popoverState;\n\n  return (\n    <>\n      <Chip\n        ref={chipRef}\n        icon={ApplicationIcons.add}\n        value=\"Add\"\n        title=\"Add a new filter\"\n        className={clsx(styles.filterChip, \"text-size-smallest\")}\n        onClick={() => setIsOpen(true)}\n      />\n      <PopOver\n        id={`${idPrefix}-add-filter-editor`}\n        isOpen={isOpen}\n        setIsOpen={setIsOpen}\n        // eslint-disable-next-line react-hooks/refs -- positionEl accepts null; PopOver/Popper handles this in effects and updates when ref is populated\n        positionEl={chipRef.current}\n        placement=\"bottom-start\"\n        showArrow={true}\n        hoverDelay={-1}\n        closeOnMouseLeave={false}\n        styles={{\n          padding: \"0.4rem\",\n          backgroundColor: \"var(--bs-light)\",\n        }}\n      >\n        <ColumnFilterEditor\n          mode=\"add\"\n          columnId={selectedColumnId ?? \"\"}\n          filterType={filterType}\n          operator={operator}\n          operatorOptions={operatorOptions}\n          rawValue={value}\n          rawValue2={value2}\n          isValueDisabled={isValueDisabled}\n          isRangeOperator={isRangeOperator}\n          onOperatorChange={setOperator}\n          onValueChange={setValue}\n          onValue2Change={setValue2}\n          onCommit={commitAndClose}\n          onCancel={cancelAndClose}\n          suggestions={suggestions}\n          columns={columns}\n          onColumnChange={handleColumnChange}\n        />\n      </PopOver>\n    </>\n  );\n};\n","import { clsx } from \"clsx\";\nimport { FC } from \"react\";\n\nimport styles from \"./ChipGroup.module.css\";\n\ninterface ChipGroupProps {\n  className?: string | string[];\n  children: React.ReactNode;\n}\n\nexport const ChipGroup: FC<ChipGroupProps> = ({ className, children }) => {\n  return <div className={clsx(styles.chipGroup, className)}>{children}</div>;\n};\n","import { clsx } from \"clsx\";\nimport { FC, ReactNode, useRef, useState } from \"react\";\n\nimport { ApplicationIcons } from \"../../components/icons\";\nimport { ToolButton } from \"../../components/ToolButton\";\n\nimport styles from \"./FilterBar.module.css\";\n\nexport interface ColumnPickerRenderProps {\n  positionEl: HTMLButtonElement | null;\n  isOpen: boolean;\n  setIsOpen: (open: boolean) => void;\n}\n\nexport interface ColumnPickerButtonProps {\n  /**\n   * Render prop for the popover content.\n   * Receives positionEl, isOpen, and setIsOpen to wire up the popover.\n   */\n  children: (props: ColumnPickerRenderProps) => ReactNode;\n}\n\n/**\n * Column picker button pattern extracted for reuse.\n * Manages button ref and open/closed state internally.\n * Uses render prop pattern to allow domain-specific popovers.\n */\nexport const ColumnPickerButton: FC<ColumnPickerButtonProps> = ({\n  children,\n}) => {\n  const buttonRef = useRef<HTMLButtonElement>(null);\n  const [isOpen, setIsOpen] = useState(false);\n\n  return (\n    <>\n      <ToolButton\n        ref={buttonRef}\n        icon={ApplicationIcons.checkbox.checked}\n        label=\"Choose columns\"\n        title=\"Choose columns\"\n        latched={isOpen}\n        onClick={() => setIsOpen(!isOpen)}\n        subtle\n        className={clsx(\"text-size-smallest\", styles.columnsButton)}\n      />\n      {children({\n        // eslint-disable-next-line react-hooks/refs -- positionEl accepts null; PopOver/Popper handles this in effects and updates when ref is populated\n        positionEl: buttonRef.current,\n        isOpen,\n        setIsOpen,\n      })}\n    </>\n  );\n};\n","import clsx from \"clsx\";\nimport { FC, useCallback, useMemo } from \"react\";\n\nimport { PopOver } from \"../../components/PopOver\";\n\nimport styles from \"./ColumnsPopover.module.css\";\n\nexport interface ColumnInfo {\n  id: string;\n  label: string;\n  headerTitle?: string;\n}\n\nexport interface ColumnsPopoverProps {\n  /** Popover positioning element */\n  positionEl: HTMLElement | null;\n  /** Whether the popover is open */\n  isOpen: boolean;\n  /** Callback to set open state */\n  setIsOpen: (open: boolean) => void;\n  /** All available columns in display order */\n  columns: ColumnInfo[];\n  /** Currently visible column IDs */\n  visibleColumns: string[];\n  /** Default visible column IDs (for \"Default\" link) */\n  defaultVisibleColumns: string[];\n  /** Callback when visible columns change */\n  onVisibleColumnsChange: (columns: string[]) => void;\n  /** Optional popover ID for accessibility */\n  popoverId?: string;\n}\n\nexport const ColumnsPopover: FC<ColumnsPopoverProps> = ({\n  positionEl,\n  isOpen,\n  setIsOpen,\n  columns,\n  visibleColumns,\n  defaultVisibleColumns,\n  onVisibleColumnsChange,\n  popoverId = \"columns-popover\",\n}) => {\n  const isDefaultSelection = useMemo(\n    () =>\n      visibleColumns.length === defaultVisibleColumns.length &&\n      visibleColumns.every((col) => defaultVisibleColumns.includes(col)),\n    [visibleColumns, defaultVisibleColumns]\n  );\n\n  const isAllSelection = useMemo(\n    () => visibleColumns.length === columns.length,\n    [visibleColumns, columns]\n  );\n\n  const setDefaultSelection = useCallback(() => {\n    onVisibleColumnsChange(defaultVisibleColumns);\n  }, [onVisibleColumnsChange, defaultVisibleColumns]);\n\n  const setAllSelection = useCallback(() => {\n    onVisibleColumnsChange(columns.map((c) => c.id));\n  }, [onVisibleColumnsChange, columns]);\n\n  const toggleColumn = useCallback(\n    (columnId: string, show: boolean) => {\n      if (show && !visibleColumns.includes(columnId)) {\n        onVisibleColumnsChange([...visibleColumns, columnId]);\n      } else if (!show) {\n        onVisibleColumnsChange(visibleColumns.filter((c) => c !== columnId));\n      }\n    },\n    [visibleColumns, onVisibleColumnsChange]\n  );\n\n  return (\n    <PopOver\n      id={popoverId}\n      positionEl={positionEl}\n      isOpen={isOpen}\n      setIsOpen={setIsOpen}\n      placement=\"bottom-end\"\n      hoverDelay={-1}\n    >\n      <div className={clsx(styles.links, \"text-size-smaller\")}>\n        <a\n          className={clsx(\n            styles.link,\n            isDefaultSelection ? styles.selected : undefined\n          )}\n          onClick={() => setDefaultSelection()}\n        >\n          Default\n        </a>\n        |\n        <a\n          className={clsx(\n            styles.link,\n            isAllSelection ? styles.selected : undefined\n          )}\n          onClick={() => setAllSelection()}\n        >\n          All\n        </a>\n      </div>\n\n      <div className={clsx(styles.columnList, \"text-size-smaller\")}>\n        {columns.map((column) => (\n          <div\n            key={column.id}\n            className={clsx(styles.row)}\n            title={[column.id, column.headerTitle].filter(Boolean).join(\"\\n\")}\n            onClick={() => {\n              toggleColumn(column.id, !visibleColumns.includes(column.id));\n            }}\n          >\n            <input\n              type=\"checkbox\"\n              checked={visibleColumns.includes(column.id)}\n              onChange={(e) => {\n                toggleColumn(column.id, e.target.checked);\n              }}\n            />\n            {column.label}\n          </div>\n        ))}\n      </div>\n    </PopOver>\n  );\n};\n","import { clsx } from \"clsx\";\nimport { FC, useCallback, useRef, useState } from \"react\";\n\nimport { ScalarValue } from \"../../api/api\";\nimport { ApplicationIcons } from \"../../components/icons\";\nimport { PopOver } from \"../../components/PopOver\";\nimport { ToolDropdownButton } from \"../../components/ToolDropdownButton\";\nimport type { SimpleCondition } from \"../../query/types\";\nimport type { ColumnFilter } from \"../../state/store\";\n\nimport { AddFilterButton, type AddFilterPopoverState } from \"./AddFilterButton\";\nimport { Chip } from \"./Chip\";\nimport { ChipGroup } from \"./ChipGroup\";\nimport {\n  ColumnFilterEditor,\n  useColumnFilterPopover,\n  type AvailableColumn,\n} from \"./columnFilter\";\nimport { ColumnPickerButton } from \"./ColumnPickerButton\";\nimport { ColumnsPopover, type ColumnInfo } from \"./ColumnsPopover\";\nimport styles from \"./FilterBar.module.css\";\n\nconst kCopyCodeDescriptors = [\n  { label: \"Code (Python)\", value: \"python\" },\n  { label: \"Filter (SQL)\", value: \"filter\" },\n];\n\nexport interface FilterBarProps {\n  /** Current column filters */\n  filters: Record<string, ColumnFilter>;\n  /** Callback when a filter condition is changed */\n  onFilterChange: (columnId: string, condition: SimpleCondition | null) => void;\n  /** Callback when a filter is removed */\n  onRemoveFilter: (columnId: string) => void;\n  /** Optional code representations for copy functionality */\n  filterCodeValues?: Record<string, string>;\n  /** Autocomplete suggestions for filter values */\n  filterSuggestions?: ScalarValue[];\n  /** Callback when filter column selection changes (for fetching suggestions) */\n  onFilterColumnChange?: (columnId: string | null) => void;\n  /** Unique ID prefix for popovers */\n  popoverIdPrefix?: string;\n\n  // Add filter button config\n  /** Popover state from useAddFilterPopover hook */\n  addFilterPopoverState: AddFilterPopoverState;\n\n  // Column picker config (optional - omit to hide)\n  /** Column definitions for the picker */\n  columns?: ColumnInfo[];\n  /** Currently visible column IDs */\n  visibleColumns?: string[];\n  /** Default visible column IDs */\n  defaultVisibleColumns?: string[];\n  /** Callback when visible columns change */\n  onVisibleColumnsChange?: (columns: string[]) => void;\n}\n\nexport const FilterBar: FC<FilterBarProps> = ({\n  filters,\n  onFilterChange,\n  onRemoveFilter,\n  filterCodeValues,\n  filterSuggestions = [],\n  onFilterColumnChange,\n  popoverIdPrefix = \"filter\",\n  addFilterPopoverState,\n  columns,\n  visibleColumns,\n  defaultVisibleColumns,\n  onVisibleColumnsChange,\n}) => {\n  // Filter editing state\n  const [editingColumnId, setEditingColumnId] = useState<string | null>(null);\n  const chipRefs = useRef<Record<string, HTMLDivElement | null>>({});\n\n  const editingFilter = editingColumnId ? filters[editingColumnId] : null;\n\n  const handleFilterChange = useCallback(\n    (condition: SimpleCondition | null) => {\n      if (!editingColumnId) return;\n      onFilterChange(editingColumnId, condition);\n    },\n    [editingColumnId, onFilterChange]\n  );\n\n  const {\n    isOpen: isEditorOpen,\n    setIsOpen: setIsEditorOpen,\n    operator,\n    setOperator,\n    operatorOptions,\n    value: rawValue,\n    setValue: setRawValue,\n    value2: rawValue2,\n    setValue2: setRawValue2,\n    isValueDisabled,\n    isRangeOperator,\n    commitAndClose,\n    cancelAndClose,\n  } = useColumnFilterPopover({\n    columnId: editingColumnId ?? \"\",\n    filterType: editingFilter?.filterType ?? \"string\",\n    condition: editingFilter?.condition ?? null,\n    onChange: handleFilterChange,\n  });\n\n  const editFilter = useCallback(\n    (columnId: string) => () => {\n      setEditingColumnId(columnId);\n      setIsEditorOpen(true);\n      onFilterColumnChange?.(columnId);\n    },\n    [setIsEditorOpen, onFilterColumnChange]\n  );\n\n  // Notify parent when editor closes\n  const handleEditorOpenChange = useCallback(\n    (open: boolean) => {\n      setIsEditorOpen(open);\n      if (!open) {\n        onFilterColumnChange?.(null);\n      }\n    },\n    [setIsEditorOpen, onFilterColumnChange]\n  );\n\n  const filterEntries = Object.values(filters);\n\n  return (\n    <div className={styles.container}>\n      <div\n        className={clsx(\n          \"text-style-label\",\n          \"text-style-secondary\",\n          \"text-size-smallest\",\n          styles.filterLabel\n        )}\n      >\n        Filter:\n      </div>\n      <ChipGroup className={styles.filterBar}>\n        {filterEntries.length > 0\n          ? filterEntries.map((filter) => {\n              if (!filter || !filter.condition) {\n                return null;\n              }\n              return (\n                <Chip\n                  key={filter.columnId}\n                  ref={(el) => {\n                    chipRefs.current[filter.columnId] = el;\n                  }}\n                  label={filter.columnId}\n                  value={formatFilterCondition(filter.condition)}\n                  title={`Edit ${filter.columnId} filter`}\n                  closeTitle=\"Remove filter\"\n                  className={clsx(styles.filterChip, \"text-size-smallest\")}\n                  onClose={() => {\n                    onRemoveFilter(filter.columnId);\n                  }}\n                  onClick={editFilter(filter.columnId)}\n                />\n              );\n            })\n          : null}\n        {/* Add Filter Button - rendered internally */}\n        <AddFilterButton\n          idPrefix={popoverIdPrefix}\n          popoverState={addFilterPopoverState}\n          suggestions={filterSuggestions}\n        />\n      </ChipGroup>\n\n      {/* Edit filter popover */}\n      {editingColumnId && editingFilter && (\n        <PopOver\n          id={`${popoverIdPrefix}-editor-${editingColumnId}`}\n          isOpen={isEditorOpen}\n          setIsOpen={handleEditorOpenChange}\n          // eslint-disable-next-line react-hooks/refs -- positionEl accepts null; PopOver/Popper handles this in effects and updates when ref is populated\n          positionEl={chipRefs.current[editingColumnId] ?? null}\n          placement=\"bottom-start\"\n          showArrow={true}\n          hoverDelay={-1}\n          closeOnMouseLeave={false}\n          styles={{\n            padding: \"0.4rem\",\n            backgroundColor: \"var(--bs-light)\",\n          }}\n        >\n          <ColumnFilterEditor\n            columnId={editingColumnId}\n            filterType={editingFilter.filterType}\n            operator={operator}\n            operatorOptions={operatorOptions}\n            rawValue={rawValue}\n            rawValue2={rawValue2}\n            isValueDisabled={isValueDisabled}\n            isRangeOperator={isRangeOperator}\n            onOperatorChange={setOperator}\n            onValueChange={setRawValue}\n            onValue2Change={setRawValue2}\n            onCommit={commitAndClose}\n            onCancel={cancelAndClose}\n            suggestions={filterSuggestions}\n          />\n        </PopOver>\n      )}\n\n      <div className={clsx(styles.actionButtons)}>\n        {filterCodeValues !== undefined && (\n          <CopyQueryButton itemValues={filterCodeValues} />\n        )}\n        {/* Column Picker - rendered if columns and handler provided */}\n        {columns && onVisibleColumnsChange && (\n          <>\n            <div className={styles.sep}></div>\n            <ColumnPickerButton>\n              {({ positionEl, isOpen, setIsOpen }) => (\n                <ColumnsPopover\n                  positionEl={positionEl}\n                  isOpen={isOpen}\n                  setIsOpen={setIsOpen}\n                  columns={columns}\n                  visibleColumns={visibleColumns ?? defaultVisibleColumns ?? []}\n                  defaultVisibleColumns={defaultVisibleColumns ?? []}\n                  onVisibleColumnsChange={onVisibleColumnsChange}\n                  popoverId={`${popoverIdPrefix}-columns`}\n                />\n              )}\n            </ColumnPickerButton>\n          </>\n        )}\n      </div>\n    </div>\n  );\n};\n\nconst CopyQueryButton: FC<{ itemValues?: Record<string, string> }> = ({\n  itemValues,\n}) => {\n  const [icon, setIcon] = useState<string>(ApplicationIcons.copy);\n\n  const items = kCopyCodeDescriptors.reduce(\n    (acc, desc) => {\n      acc[desc.label] = () => {\n        const text = itemValues ? itemValues[desc.value] : \"\";\n        if (!text) {\n          return;\n        }\n\n        void navigator.clipboard.writeText(text);\n        setIcon(ApplicationIcons.confirm);\n        setTimeout(() => {\n          setIcon(ApplicationIcons.copy);\n        }, 1250);\n      };\n      return acc;\n    },\n    {} as Record<string, () => void>\n  );\n\n  return (\n    <ToolDropdownButton\n      key=\"query-copy\"\n      label=\"Copy\"\n      icon={icon}\n      title=\"Copy Filter\"\n      className={clsx(styles.actionButton, styles.chipButton, styles.right)}\n      disabled={Object.keys(itemValues || []).length === 0}\n      dropdownAlign=\"right\"\n      dropdownClassName={\"text-size-smallest\"}\n      items={items}\n    />\n  );\n};\n\nconst formatRepresentativeType = (value: unknown): string => {\n  if (value === null) {\n    return \"NULL\";\n  } else if (Array.isArray(value)) {\n    return `[${value.map((v) => formatRepresentativeType(v)).join(\", \")}]`;\n  } else if (typeof value === \"object\") {\n    return \"{...}\";\n  } else if (typeof value === \"string\") {\n    return `'${value}'`;\n  } else {\n    return String(value);\n  }\n};\n\n/**\n * Formats a filter condition for display in a chip.\n * Handles special formatting for BETWEEN, IN, and other operators.\n */\nconst formatFilterCondition = (condition: SimpleCondition): string => {\n  const { operator, right } = condition;\n\n  // BETWEEN / NOT BETWEEN: show as \"BETWEEN value1 AND value2\"\n  if (\n    (operator === \"BETWEEN\" || operator === \"NOT BETWEEN\") &&\n    Array.isArray(right) &&\n    right.length === 2\n  ) {\n    const v1 = formatRepresentativeType(right[0]);\n    const v2 = formatRepresentativeType(right[1]);\n    return `${operator} ${v1} AND ${v2}`;\n  }\n\n  // IN / NOT IN: show as \"IN (value1, value2, ...)\"\n  if ((operator === \"IN\" || operator === \"NOT IN\") && Array.isArray(right)) {\n    const values = right.map((v) => formatRepresentativeType(v)).join(\", \");\n    return `${operator} (${values})`;\n  }\n\n  // IS NULL / IS NOT NULL: no value needed\n  if (operator === \"IS NULL\" || operator === \"IS NOT NULL\") {\n    return operator;\n  }\n\n  // Default: \"operator value\"\n  return `${operator} ${formatRepresentativeType(right)}`;\n};\n\n// Export types for convenience\nexport type { AddFilterPopoverState, AvailableColumn, ColumnInfo };\n","import { useCallback, useMemo } from \"react\";\n\nimport type { SimpleCondition } from \"../../query/types\";\nimport { ColumnFilter } from \"../../state/store\";\n\n/**\n * Base table state interface that filter bar handlers can work with.\n * Both ScansTableState and TranscriptsTableState conform to this.\n */\ninterface BaseTableState {\n  columnFilters: Record<string, ColumnFilter>;\n  visibleColumns?: string[];\n  columnOrder: string[];\n}\n\ninterface FilterBarHandlers {\n  /**\n   * Update a filter's condition or remove it if condition is null\n   */\n  handleFilterChange: (\n    columnId: string,\n    condition: SimpleCondition | null\n  ) => void;\n  /**\n   * Remove a filter by column ID\n   */\n  removeFilter: (column: string) => void;\n  /**\n   * Add a new filter, ensuring the column is visible\n   */\n  handleAddFilter: (filter: ColumnFilter) => void;\n}\n\n/**\n * Creates filter bar handler functions for a table state.\n * This is the core logic shared between scans and transcripts filter bars.\n *\n * @param setTableState - Store setter function\n * @param defaultVisibleColumns - Default columns when state doesn't have them\n * @returns Object with handler functions\n */\nfunction createFilterBarHandlers<\n  TColumnKey extends string,\n  TState extends BaseTableState = BaseTableState,\n>(\n  setTableState: (updater: TState | ((prev: TState) => TState)) => void,\n  defaultVisibleColumns: readonly TColumnKey[]\n): FilterBarHandlers {\n  const handleFilterChange = (\n    columnId: string,\n    condition: SimpleCondition | null\n  ) => {\n    setTableState((prevState) => {\n      const newFilters = { ...prevState.columnFilters };\n      if (condition === null) {\n        delete newFilters[columnId];\n      } else {\n        const existingFilter = newFilters[columnId];\n        if (existingFilter) {\n          newFilters[columnId] = {\n            ...existingFilter,\n            condition,\n          };\n        }\n      }\n      return {\n        ...prevState,\n        columnFilters: newFilters,\n      };\n    });\n  };\n\n  const removeFilter = (column: string) => {\n    setTableState((prevState) => {\n      const newFilters = { ...prevState.columnFilters };\n      delete newFilters[column];\n      return {\n        ...prevState,\n        columnFilters: newFilters,\n      };\n    });\n  };\n\n  const handleAddFilter = (filter: ColumnFilter) => {\n    setTableState((prevState) => {\n      const columnKey = filter.columnId as TColumnKey;\n\n      // Use default visible columns if not set in state\n      const currentVisibleColumns =\n        (prevState.visibleColumns as TColumnKey[] | undefined) ??\n        ([...defaultVisibleColumns] as TColumnKey[]);\n\n      // Check if we need to add this column to visible columns\n      const needsColumnVisible = !currentVisibleColumns.includes(columnKey);\n\n      // Check if we need to add this column to column order\n      const columnOrder = prevState.columnOrder as TColumnKey[];\n      const needsColumnOrder =\n        columnOrder.length > 0 && !columnOrder.includes(columnKey);\n\n      return {\n        ...prevState,\n        columnFilters: {\n          ...prevState.columnFilters,\n          [filter.columnId]: filter,\n        },\n        // Add the column to visible columns if it's not already there\n        ...(needsColumnVisible && {\n          visibleColumns: [...currentVisibleColumns, columnKey],\n        }),\n        // Add the column to column order if it's not already there\n        ...(needsColumnOrder && {\n          columnOrder: [...columnOrder, columnKey],\n        }),\n      };\n    });\n  };\n\n  return {\n    handleFilterChange,\n    removeFilter,\n    handleAddFilter,\n  };\n}\n\ninterface UseFilterBarHandlersOptions<\n  TColumnKey extends string,\n  TState extends BaseTableState = BaseTableState,\n> {\n  /**\n   * Store setter function that accepts an updater\n   */\n  setTableState: (updater: TState | ((prev: TState) => TState)) => void;\n  /**\n   * Default visible columns to use when state doesn't have them set\n   */\n  defaultVisibleColumns: readonly TColumnKey[];\n}\n\n/**\n * Hook that provides common filter bar handlers for both scans and transcripts tables.\n * Extracts the duplicated logic from ScansFilterBar and TranscriptFilterBar.\n */\nexport function useFilterBarHandlers<\n  TColumnKey extends string,\n  TState extends BaseTableState = BaseTableState,\n>({\n  setTableState,\n  defaultVisibleColumns,\n}: UseFilterBarHandlersOptions<TColumnKey, TState>): FilterBarHandlers {\n  // Memoize the handlers to maintain referential stability\n  const handlers = useMemo(\n    () => createFilterBarHandlers(setTableState, defaultVisibleColumns),\n    [setTableState, defaultVisibleColumns]\n  );\n\n  // Wrap in useCallback for consistent return types\n  const handleFilterChange = useCallback(\n    (columnId: string, condition: SimpleCondition | null) => {\n      handlers.handleFilterChange(columnId, condition);\n    },\n    [handlers]\n  );\n\n  const removeFilter = useCallback(\n    (column: string) => {\n      handlers.removeFilter(column);\n    },\n    [handlers]\n  );\n\n  const handleAddFilter = useCallback(\n    (filter: ColumnFilter) => {\n      handlers.handleAddFilter(filter);\n    },\n    [handlers]\n  );\n\n  return {\n    handleFilterChange,\n    removeFilter,\n    handleAddFilter,\n  };\n}\n"],"names":["forwardRef","columnId","jsx","styles","useMemo","jsxs","useCallback","operator","Fragment","useState","useRef","useEffect","value","value2","parsed"],"mappings":"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"}