{"version":3,"file":"useScansDir.js","sources":["../../src/app/hooks/useScanRoute.ts","../../src/app/components/ScansNavbar.tsx","../../src/app/utils/useScansDir.ts"],"sourcesContent":["import { useEffect, useMemo } from \"react\";\nimport { useParams } from \"react-router-dom\";\n\nimport { parseScanParams } from \"../../router/url\";\nimport { useStore } from \"../../state/store\";\nimport { join } from \"../../utils/uri\";\nimport { useAppConfig } from \"../server/useAppConfig\";\n\nexport const useScanRoute = (): {\n  scansDir?: string;\n  relativePath: string;\n  scanPath: string;\n  scanResultUuid?: string;\n  resolvedScansDir?: string;\n  location?: string;\n} => {\n  const params = useParams<{ scansDir?: string; \"*\": string }>();\n  const setUserScansDir = useStore((state) => state.setUserScansDir);\n  const config = useAppConfig();\n  const scansDir = config.scans.dir;\n\n  const route = useMemo(() => parseScanParams(params), [params]);\n  const resolvedScansDir = route.scansDir || scansDir;\n  const location = resolvedScansDir\n    ? join(route.scanPath, resolvedScansDir)\n    : undefined;\n\n  useEffect(() => {\n    if (route.scansDir) {\n      setUserScansDir(route.scansDir);\n    }\n  }, [route.scansDir, setUserScansDir]);\n\n  return {\n    ...route,\n    resolvedScansDir,\n    location,\n  };\n};\n","import { FC, ReactNode, useMemo } from \"react\";\nimport { useSearchParams } from \"react-router-dom\";\n\nimport { ApplicationIcons } from \"../../components/icons\";\nimport { scanRoute, scansRoute } from \"../../router/url\";\nimport { useStore } from \"../../state/store\";\nimport { dirname } from \"../../utils/path\";\nimport { useScanRoute } from \"../hooks/useScanRoute\";\n\nimport { EditablePath } from \"./EditablePath\";\nimport { Navbar } from \"./Navbar\";\nimport { NavButton } from \"./NavButtons\";\n\ninterface ScansNavbarProps {\n  scansDir: string | null;\n  scansDirSource?: \"route\" | \"user\" | \"project\" | \"cli\";\n  setScansDir: (path: string) => void;\n  children?: ReactNode;\n  bordered?: boolean;\n}\n\nexport const ScansNavbar: FC<ScansNavbarProps> = ({\n  scansDir,\n  scansDirSource,\n  setScansDir,\n  bordered = true,\n  children,\n}) => {\n  const {\n    relativePath,\n    scanPath,\n    scanResultUuid,\n    scansDir: routeScansDir,\n  } = useScanRoute();\n  const singleFileMode = useStore((state) => state.singleFileMode);\n  const [searchParams] = useSearchParams();\n\n  // Check if we're on a scan result page and calculate the appropriate back URL\n  const resolvedScansDir = routeScansDir || scansDir;\n\n  const backUrl =\n    resolvedScansDir && scanResultUuid\n      ? scanRoute(resolvedScansDir, scanPath, searchParams)\n      : !singleFileMode && resolvedScansDir\n        ? scansRoute(resolvedScansDir, dirname(relativePath || \"\"))\n        : undefined;\n\n  const navButtons: NavButton[] = useMemo(() => {\n    const buttons: NavButton[] = [];\n\n    if (backUrl) {\n      buttons.push({\n        title: \"Back\",\n        icon: ApplicationIcons.navbar.back,\n        route: backUrl,\n        enabled: !!scanPath,\n      });\n    }\n\n    if (!singleFileMode && resolvedScansDir) {\n      buttons.push({\n        title: \"Home\",\n        icon: ApplicationIcons.navbar.home,\n        route: scansRoute(resolvedScansDir),\n        enabled: !!scanPath,\n      });\n    }\n\n    return buttons;\n  }, [backUrl, singleFileMode, scanPath, resolvedScansDir]);\n\n  return (\n    <Navbar\n      bordered={bordered}\n      right={children}\n      leftButtons={navButtons.length > 0 ? navButtons : undefined}\n      left={\n        scansDir ? (\n          <EditablePath\n            path={scansDir}\n            label=\"Scans\"\n            icon={\n              scansDirSource === \"cli\" ? ApplicationIcons.terminal : undefined\n            }\n            title={\n              scansDirSource === \"cli\"\n                ? \"Scans directory set via command line\"\n                : undefined\n            }\n            onPathChanged={setScansDir}\n            placeholder=\"Select Scans Folder\"\n            className=\"text-size-smallest\"\n            editable={false}\n          />\n        ) : undefined\n      }\n    />\n  );\n};\n","import { useStore } from \"../../state/store\";\nimport { useScanRoute } from \"../hooks/useScanRoute\";\nimport { appAliasedPath, useAppConfig } from \"../server/useAppConfig\";\n\ninterface UseScansDirResult {\n  displayScansDir: string;\n  resolvedScansDir: string;\n  resolvedScansDirSource: \"route\" | \"user\" | \"project\" | \"cli\";\n  setScansDir: (path: string) => void;\n}\n\nexport function useScansDir(useRouteParam = false): UseScansDirResult {\n  const config = useAppConfig();\n  const { scansDir: routeScansDir } = useScanRoute();\n  const userScansDir = useStore((state) => state.userScansDir);\n  const setUserScansDir = useStore((state) => state.setUserScansDir);\n\n  // TODO: || \"\" is a smell. Fix them\n  const resolvedPath =\n    (useRouteParam ? routeScansDir : null) ||\n    userScansDir ||\n    config.scans.dir ||\n    \"\";\n\n  const scanDirSource =\n    useRouteParam && routeScansDir\n      ? \"route\"\n      : userScansDir\n        ? \"user\"\n        : config.scans.source === \"cli\"\n          ? \"cli\"\n          : \"project\";\n\n  const displayPath = appAliasedPath(config, resolvedPath) || \"\";\n\n  return {\n    displayScansDir: displayPath,\n    resolvedScansDir: resolvedPath,\n    resolvedScansDirSource: scanDirSource,\n    setScansDir: setUserScansDir,\n  };\n}\n"],"names":["useMemo","useEffect","jsx"],"mappings":"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"}