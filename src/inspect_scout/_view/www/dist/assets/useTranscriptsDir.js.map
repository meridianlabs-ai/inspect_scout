{"version":3,"file":"useTranscriptsDir.js","sources":["../../src/app/utils/router.ts","../../src/app/utils/useTranscriptsDir.ts"],"sourcesContent":["import { useEffect, useMemo } from \"react\";\nimport { useParams } from \"react-router-dom\";\n\nimport { useStore } from \"../../state/store\";\nimport { decodeBase64Url } from \"../../utils/base64url\";\n\nexport const useTranscriptDirParams = (): string | undefined => {\n  const params = useParams<{ transcriptsDir?: string }>();\n  const setUserTranscriptsDir = useStore(\n    (state) => state.setUserTranscriptsDir\n  );\n\n  const decodedTranscriptDir = useMemo(() => {\n    if (params.transcriptsDir) {\n      return decodeBase64Url(params.transcriptsDir);\n    }\n    return undefined;\n  }, [params.transcriptsDir]);\n\n  useEffect(() => {\n    if (decodedTranscriptDir) {\n      setUserTranscriptsDir(decodedTranscriptDir);\n    }\n  }, [decodedTranscriptDir, setUserTranscriptsDir]);\n\n  return decodedTranscriptDir;\n};\n","import { useStore } from \"../../state/store\";\nimport { appAliasedPath, useAppConfig } from \"../server/useAppConfig\";\n\nimport { useTranscriptDirParams } from \"./router\";\n\ninterface UseTranscriptsDirResult {\n  displayTranscriptsDir: string;\n  resolvedTranscriptsDir: string;\n  resolvedTranscriptsDirSource: \"route\" | \"user\" | \"project\" | \"cli\";\n  setTranscriptsDir: (path: string) => void;\n}\n\nexport function useTranscriptsDir(\n  useRouteParam = false\n): UseTranscriptsDirResult {\n  const config = useAppConfig();\n  const routeTranscriptsDir = useTranscriptDirParams();\n  const userTranscriptsDir = useStore((state) => state.userTranscriptsDir);\n  const setUserTranscriptsDir = useStore(\n    (state) => state.setUserTranscriptsDir\n  );\n\n  // TODO: || \"\" is a smell. Fix them\n  const resolvedPath =\n    (useRouteParam ? routeTranscriptsDir : null) ||\n    userTranscriptsDir ||\n    config.transcripts?.dir ||\n    \"\";\n\n  const resolvedSource =\n    useRouteParam && routeTranscriptsDir\n      ? \"route\"\n      : userTranscriptsDir\n        ? \"user\"\n        : config.transcripts && config.transcripts?.source === \"cli\"\n          ? \"cli\"\n          : \"project\";\n\n  const displayPath = appAliasedPath(config, resolvedPath) || \"\";\n\n  return {\n    displayTranscriptsDir: displayPath,\n    resolvedTranscriptsDir: resolvedPath,\n    resolvedTranscriptsDirSource: resolvedSource,\n    setTranscriptsDir: setUserTranscriptsDir,\n  };\n}\n"],"names":["useMemo","useEffect"],"mappings":";AAMO,MAAM,yBAAyB,MAA0B;AAC9D,QAAM,SAAS,UAAA;AACf,QAAM,wBAAwB;AAAA,IAC5B,CAAC,UAAU,MAAM;AAAA,EAAA;AAGnB,QAAM,uBAAuBA,aAAAA,QAAQ,MAAM;AACzC,QAAI,OAAO,gBAAgB;AACzB,aAAO,gBAAgB,OAAO,cAAc;AAAA,IAC9C;AACA,WAAO;AAAA,EACT,GAAG,CAAC,OAAO,cAAc,CAAC;AAE1BC,eAAAA,UAAU,MAAM;AACd,QAAI,sBAAsB;AACxB,4BAAsB,oBAAoB;AAAA,IAC5C;AAAA,EACF,GAAG,CAAC,sBAAsB,qBAAqB,CAAC;AAEhD,SAAO;AACT;ACdO,SAAS,kBACd,gBAAgB,OACS;AACzB,QAAM,SAAS,aAAA;AACf,QAAM,sBAAsB,uBAAA;AAC5B,QAAM,qBAAqB,SAAS,CAAC,UAAU,MAAM,kBAAkB;AACvE,QAAM,wBAAwB;AAAA,IAC5B,CAAC,UAAU,MAAM;AAAA,EAAA;AAInB,QAAM,gBACH,gBAAgB,sBAAsB,SACvC,sBACA,OAAO,aAAa,OACpB;AAEF,QAAM,iBACJ,iBAAiB,sBACb,UACA,qBACE,SACA,OAAO,eAAe,OAAO,aAAa,WAAW,QACnD,QACA;AAEV,QAAM,cAAc,eAAe,QAAQ,YAAY,KAAK;AAE5D,SAAO;AAAA,IACL,uBAAuB;AAAA,IACvB,wBAAwB;AAAA,IACxB,8BAA8B;AAAA,IAC9B,mBAAmB;AAAA,EAAA;AAEvB;"}